/**
 * name: note-book
 * version: v1.0.9
 * description: ç¬”è®°æœ¬ ğŸ“š  ä¸–ç•Œä¸Šåªæœ‰10ç±»äººï¼šä¸€ç±»æ˜¯æ‡‚äºŒè¿›åˆ¶çš„ï¼Œä¸€ç±»æ˜¯ä¸æ‡‚çš„ã€‚
 * author: Alimales <only_tigerhu@163.com>
 * homepage: https://www.tigerzh.com
 */
import{_ as s,o as n,c as a,a as l}from"./app.a5d386c5.js";const p=JSON.parse('{"title":"Nginx","description":"","frontmatter":{},"headers":[{"level":2,"title":"ç®€ä»‹","slug":"ç®€ä»‹","link":"#ç®€ä»‹","children":[]},{"level":2,"title":"Nginxçš„å®‰è£…","slug":"nginxçš„å®‰è£…","link":"#nginxçš„å®‰è£…","children":[]},{"level":2,"title":"Nginxé…ç½®æ–‡ä»¶æ„æˆ","slug":"nginxé…ç½®æ–‡ä»¶æ„æˆ","link":"#nginxé…ç½®æ–‡ä»¶æ„æˆ","children":[]},{"level":2,"title":"Nginxé…ç½®æ–‡ä»¶ç¤ºä¾‹","slug":"nginxé…ç½®æ–‡ä»¶ç¤ºä¾‹","link":"#nginxé…ç½®æ–‡ä»¶ç¤ºä¾‹","children":[]},{"level":2,"title":"Nginx Locationé…ç½®","slug":"nginx-locationé…ç½®","link":"#nginx-locationé…ç½®","children":[]},{"level":2,"title":"URLåŒ¹é…æ–¹å¼åŠä¼˜å…ˆçº§","slug":"urlåŒ¹é…æ–¹å¼åŠä¼˜å…ˆçº§","link":"#urlåŒ¹é…æ–¹å¼åŠä¼˜å…ˆçº§","children":[]},{"level":2,"title":"è¯·æ±‚è½¬å‘å’Œé‡å®šå‘","slug":"è¯·æ±‚è½¬å‘å’Œé‡å®šå‘","link":"#è¯·æ±‚è½¬å‘å’Œé‡å®šå‘","children":[]},{"level":2,"title":"Nginxé™æ€æ–‡ä»¶é…ç½®","slug":"nginxé™æ€æ–‡ä»¶é…ç½®","link":"#nginxé™æ€æ–‡ä»¶é…ç½®","children":[]},{"level":2,"title":"é™æ€æ–‡ä»¶ç¼“å­˜","slug":"é™æ€æ–‡ä»¶ç¼“å­˜","link":"#é™æ€æ–‡ä»¶ç¼“å­˜","children":[]},{"level":2,"title":"é™æ€æ–‡ä»¶å‹ç¼©","slug":"é™æ€æ–‡ä»¶å‹ç¼©","link":"#é™æ€æ–‡ä»¶å‹ç¼©","children":[]},{"level":2,"title":"æ–‡ä»¶ä¸‹è½½æœåŠ¡å™¨","slug":"æ–‡ä»¶ä¸‹è½½æœåŠ¡å™¨","link":"#æ–‡ä»¶ä¸‹è½½æœåŠ¡å™¨","children":[]},{"level":2,"title":"Nginxé…ç½®HTTPS","slug":"nginxé…ç½®https","link":"#nginxé…ç½®https","children":[]},{"level":2,"title":"Nginxæ—¥å¿—é…ç½®","slug":"nginxæ—¥å¿—é…ç½®","link":"#nginxæ—¥å¿—é…ç½®","children":[]},{"level":2,"title":"Nginxè¶…æ—¶è®¾ç½®","slug":"nginxè¶…æ—¶è®¾ç½®","link":"#nginxè¶…æ—¶è®¾ç½®","children":[]},{"level":2,"title":"è¯·æ±‚è¶…æ—¶è®¾ç½®","slug":"è¯·æ±‚è¶…æ—¶è®¾ç½®","link":"#è¯·æ±‚è¶…æ—¶è®¾ç½®","children":[]},{"level":2,"title":"Proxyåå‘ä»£ç†è¶…æ—¶è®¾ç½®","slug":"proxyåå‘ä»£ç†è¶…æ—¶è®¾ç½®","link":"#proxyåå‘ä»£ç†è¶…æ—¶è®¾ç½®","children":[]},{"level":2,"title":"Nginxè´Ÿè½½å‡è¡¡","slug":"nginxè´Ÿè½½å‡è¡¡","link":"#nginxè´Ÿè½½å‡è¡¡","children":[]},{"level":2,"title":"è½®è¯¢(é»˜è®¤)","slug":"è½®è¯¢-é»˜è®¤","link":"#è½®è¯¢-é»˜è®¤","children":[]},{"level":2,"title":"æƒé‡(weight)","slug":"æƒé‡-weight","link":"#æƒé‡-weight","children":[]},{"level":2,"title":"ip_hash","slug":"ip-hash","link":"#ip-hash","children":[]},{"level":2,"title":"url_hash","slug":"url-hash","link":"#url-hash","children":[]},{"level":2,"title":"fair(ç¬¬ä¸‰æ–¹)","slug":"fair-ç¬¬ä¸‰æ–¹","link":"#fair-ç¬¬ä¸‰æ–¹","children":[]},{"level":2,"title":"Nginxä¸uWSGIæœåŠ¡å™¨çš„æ²Ÿé€š","slug":"nginxä¸uwsgiæœåŠ¡å™¨çš„æ²Ÿé€š","link":"#nginxä¸uwsgiæœåŠ¡å™¨çš„æ²Ÿé€š","children":[{"level":3,"title":"Python Webåº”ç”¨éƒ¨ç½²è´Ÿè½½å‡è¡¡Nginxé…ç½®æ–‡ä»¶å‚è€ƒ","slug":"python-webåº”ç”¨éƒ¨ç½²è´Ÿè½½å‡è¡¡nginxé…ç½®æ–‡ä»¶å‚è€ƒ","link":"#python-webåº”ç”¨éƒ¨ç½²è´Ÿè½½å‡è¡¡nginxé…ç½®æ–‡ä»¶å‚è€ƒ","children":[]}]},{"level":2,"title":"ç¤ºä¾‹","slug":"ç¤ºä¾‹","link":"#ç¤ºä¾‹","children":[]},{"level":2,"title":"é»˜è®¤ nginx ç›®å½•è·¯å¾„ã€‚","slug":"é»˜è®¤-nginx-ç›®å½•è·¯å¾„ã€‚","link":"#é»˜è®¤-nginx-ç›®å½•è·¯å¾„ã€‚","children":[]},{"level":2,"title":"æˆ‘çš„nginxé…ç½®","slug":"æˆ‘çš„nginxé…ç½®","link":"#æˆ‘çš„nginxé…ç½®","children":[]}],"relativePath":"note/nginx.md"}'),o={name:"note/nginx.md"},e=[l('<h1 id="nginx" tabindex="-1">Nginx <a class="header-anchor" href="#nginx" aria-hidden="true">#</a></h1><h2 id="ç®€ä»‹" tabindex="-1"><strong>ç®€ä»‹</strong> <a class="header-anchor" href="#ç®€ä»‹" aria-hidden="true">#</a></h2><p>è½»é‡ã€å¼€æºã€HTTPæœåŠ¡å™¨è½¯ä»¶ï¼å¯ä»¥å’Œapacheé…åˆä½¿ç”¨ã€‚</p><p>nginxåŸºäºäº‹ä»¶å’Œå¼‚æ­¥æ“ä½œï¼Œè®¿é—®é‡å¾ˆå¤§çš„æ—¶å€™å¯ä»¥è½»æ¾å¤„ç†ï¼›</p><p>apacheä¾èµ–äºçº¿ç¨‹ï¼Œè®¿é—®é‡å¤§ä¼šå¤§é‡æ–°å¢çº¿ç¨‹ï¼Œå¾ˆå¿«è€—å°½å†…å­˜ã€‚</p><h2 id="nginxçš„å®‰è£…" tabindex="-1">Nginxçš„å®‰è£… <a class="header-anchor" href="#nginxçš„å®‰è£…" aria-hidden="true">#</a></h2><p>Nginxçš„å®‰è£…å¾ˆç®€å•ï¼Œç½‘ä¸Šæ•™ç¨‹å¾ˆå¤šï¼Œè¿™é‡Œä»…ä»¥Ubuntuç³»ç»Ÿ(Linux)æ¼”ç¤ºï¼š</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#676E95;font-style:italic;"># å®‰è£…nginx</span></span>\n<span class="line"><span style="color:#FFCB6B;">sudo</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">apt-get</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">install</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">nginx</span></span>\n<span class="line"></span>\n<span class="line"><span style="color:#676E95;font-style:italic;"># å¯åŠ¨nginxæœåŠ¡</span></span>\n<span class="line"><span style="color:#FFCB6B;">sudo</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">systemctl</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">nginx</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">start</span></span>\n<span class="line"></span></code></pre></div><p>Nginxå¯åŠ¨æ—¶é€šå¸¸ä¼šä½¿ç”¨é»˜è®¤è®¾ç½®, ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤å¯ä»¥è®©è‡ªå·±çš„é…ç½®æ–‡ä»¶ç”Ÿæ•ˆã€‚</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#676E95;font-style:italic;"># åˆ é™¤/etc/nginx/sites-available/ç›®å½•ä¸‹é»˜è®¤è‡ªå®šä¹‰é…ç½®</span></span>\n<span class="line"><span style="color:#FFCB6B;">sudo</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">rm</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-rf</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/etc/nginx/sites-available/default</span></span>\n<span class="line"></span>\n<span class="line"><span style="color:#676E95;font-style:italic;"># sites-availableç›®å½•ä¸‹æ–°å»ºè‡ªå®šä¹‰é…ç½®æ–‡ä»¶,å¯ä»¥1ä¸ªç½‘ç«™1ä¸ª</span></span>\n<span class="line"><span style="color:#FFCB6B;">sudo</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">nano</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/etc/nginx/sites-available/myapp1</span></span>\n<span class="line"></span>\n<span class="line"><span style="color:#676E95;font-style:italic;"># ä¸sites-enabledç›®å½•å»ºç«‹è½¯é“¾ï¼Œå¯è®©è‡ªå®šä¹‰é…ç½®æ–‡ä»¶ç”Ÿæ•ˆ</span></span>\n<span class="line"><span style="color:#FFCB6B;">sudo</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">ln</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-s</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/etc/nginx/sites-available/myapp1</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/etc/nginx/sites-enabled</span></span>\n<span class="line"></span>\n<span class="line"><span style="color:#676E95;font-style:italic;"># æ£€æŸ¥nginxé…ç½®æ–‡ä»¶æ˜¯å¦æœ‰é—®é¢˜</span></span>\n<span class="line"><span style="color:#FFCB6B;">sudo</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">systemctl</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">nginx</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">â€“t</span></span>\n<span class="line"></span>\n<span class="line"><span style="color:#676E95;font-style:italic;"># é‡å¯nginxæœåŠ¡</span></span>\n<span class="line"><span style="color:#FFCB6B;">sudo</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">systemctl</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">nginx</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">restart</span></span>\n<span class="line"></span></code></pre></div><p><strong>æ³¨æ„</strong>ï¼šå¦‚æœä½ ä¸æ˜¯ä½¿ç”¨<code>sudo apt-get</code>å‘½ä»¤å®‰è£…çš„nginxï¼Œè€Œæ˜¯ç›´æ¥ä½¿ç”¨<code>yum</code>å‘½ä»¤æˆ–dockeré•œåƒå®‰è£…çš„ï¼Œnginxçš„é»˜è®¤è‡ªå®šä¹‰é…ç½®æ–‡ä»¶ä½äº<code>/etc/nginx/conf.d/default.conf</code>ã€‚å¦‚æœä½ å¸Œæœ›è®©è‡ªå®šä¹‰é…ç½®æ–‡ä»¶ç”Ÿæ•ˆï¼Œä½ éœ€è¦å…ˆåˆ é™¤è¿™ä¸ªé»˜è®¤é…ç½®æ–‡ä»¶ï¼Œç„¶ååœ¨``/etc/nginx/conf.d/<code>ç›®å½•ä¸‹æ–°å»ºä¸€ä¸ª</code>nginx.conf`ã€‚</p><p>å¦‚æœä½ ä½¿ç”¨dockerå®‰è£…nginxï¼ŒDockerfileé‡Œå¯ä»¥è®¾ç½®å°†å®¿ä¸»æœºçš„å½“å‰ç›®å½•ä¸‹çš„<code>nginx.conf</code>å¤åˆ¶ä¸€ä»½åˆ°çš„å®¹å™¨å†…çš„<code>/etc/nginx/conf.d/</code>çš„ç›®å½•ä¸‹ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#676E95;font-style:italic;"># nginxé•œåƒDockerfile</span></span>\n<span class="line"><span style="color:#FFCB6B;">FROM</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">nginx:latest</span></span>\n<span class="line"></span>\n<span class="line"><span style="color:#676E95;font-style:italic;"># åˆ é™¤åŸæœ‰é…ç½®æ–‡ä»¶ï¼Œåˆ›å»ºé™æ€èµ„æºæ–‡ä»¶å¤¹å’Œsslè¯ä¹¦ä¿å­˜æ–‡ä»¶å¤¹</span></span>\n<span class="line"><span style="color:#FFCB6B;">RUN</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">rm</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/etc/nginx/conf.d/default.conf</span><span style="color:#A6ACCD;"> </span></span>\n<span class="line"></span>\n<span class="line"><span style="color:#676E95;font-style:italic;"># å°†è‡ªå®šä¹‰é…ç½®æ–‡ä»¶nginx.confå¤åˆ¶åˆ°å®¹å™¨å†…/etc/nginx/conf.d/ç›®å½•</span></span>\n<span class="line"><span style="color:#FFCB6B;">ADD</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">./nginx.conf</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/etc/nginx/conf.d/</span></span>\n<span class="line"></span>\n<span class="line"><span style="color:#676E95;font-style:italic;"># å…³é—­å®ˆæŠ¤æ¨¡å¼</span></span>\n<span class="line"><span style="color:#FFCB6B;">CMD</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">nginx</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">,</span><span style="color:#89DDFF;"> &quot;</span><span style="color:#C3E88D;">-g</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">,</span><span style="color:#89DDFF;"> &quot;</span><span style="color:#C3E88D;">daemon off;</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">]</span></span>\n<span class="line"></span></code></pre></div><h2 id="nginxé…ç½®æ–‡ä»¶æ„æˆ" tabindex="-1">Nginxé…ç½®æ–‡ä»¶æ„æˆ <a class="header-anchor" href="#nginxé…ç½®æ–‡ä»¶æ„æˆ" aria-hidden="true">#</a></h2><p>ä¸€ä¸ªNginxé…ç½®æ–‡ä»¶é€šå¸¸åŒ…å«3ä¸ªæ¨¡å—ï¼š</p><ul><li>å…¨å±€å—ï¼šæ¯”å¦‚å·¥ä½œè¿›ç¨‹æ•°ï¼Œå®šä¹‰æ—¥å¿—è·¯å¾„ï¼›</li><li>Eventså—ï¼šè®¾ç½®å¤„ç†è½®è¯¢äº‹ä»¶æ¨¡å‹ï¼Œæ¯ä¸ªå·¥ä½œè¿›ç¨‹æœ€å¤§è¿æ¥æ•°åŠhttpå±‚çš„keep-aliveè¶…æ—¶æ—¶é—´ï¼›</li><li>httpå—ï¼šè·¯ç”±åŒ¹é…ã€é™æ€æ–‡ä»¶æœåŠ¡å™¨ã€åå‘ä»£ç†ã€è´Ÿè½½å‡è¡¡ç­‰ã€‚</li></ul><p>å…¶ä¸­httpå—åˆå¯ä»¥è¿›ä¸€æ­¥åˆ†æˆ3å—ï¼Œhttpå…¨å±€å—é‡Œçš„é…ç½®å¯¹æ‰€æœ‰ç«™ç‚¹ç”Ÿæ•ˆï¼Œserverå—é…ç½®ä»…å¯¹å•ä¸ªç«™ç‚¹ç”Ÿæ•ˆï¼Œè€Œlocationå—çš„é…ç½®ä»…å¯¹å•ä¸ªé¡µé¢æˆ–urlç”Ÿæ•ˆã€‚</p><h2 id="nginxé…ç½®æ–‡ä»¶ç¤ºä¾‹" tabindex="-1">Nginxé…ç½®æ–‡ä»¶ç¤ºä¾‹ <a class="header-anchor" href="#nginxé…ç½®æ–‡ä»¶ç¤ºä¾‹" aria-hidden="true">#</a></h2><div class="language-nginx"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#676E95;font-style:italic;"># å…¨å±€å—</span></span>\n<span class="line"><span style="color:#89DDFF;">user </span><span style="color:#A6ACCD;">www-data</span><span style="color:#89DDFF;">;</span></span>\n<span class="line"><span style="color:#89DDFF;">worker_processes </span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">2</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;">  </span><span style="color:#676E95;font-style:italic;">## é»˜è®¤1ï¼Œä¸€èˆ¬å»ºè®®è®¾æˆCPUæ ¸æ•°1-2å€</span></span>\n<span class="line"><span style="color:#89DDFF;">error_log </span><span style="color:#A6ACCD;"> logs/error.log</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">## é”™è¯¯æ—¥å¿—è·¯å¾„</span></span>\n<span class="line"><span style="color:#89DDFF;">pid </span><span style="color:#A6ACCD;"> logs/nginx.pid</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">## è¿›ç¨‹id</span></span>\n<span class="line"></span>\n<span class="line"><span style="color:#676E95;font-style:italic;"># Eventså—</span></span>\n<span class="line"><span style="color:#C792EA;">events</span><span style="color:#A6ACCD;"> {</span></span>\n<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#676E95;font-style:italic;"># ä½¿ç”¨epollçš„I/O æ¨¡å‹å¤„ç†è½®è¯¢äº‹ä»¶ã€‚</span></span>\n<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#676E95;font-style:italic;"># å¯ä»¥ä¸è®¾ç½®ï¼Œnginxä¼šæ ¹æ®æ“ä½œç³»ç»Ÿé€‰æ‹©åˆé€‚çš„æ¨¡å‹</span></span>\n<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> use </span><span style="color:#A6ACCD;">epoll</span><span style="color:#89DDFF;">;</span></span>\n<span class="line"><span style="color:#A6ACCD;">  </span></span>\n<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#676E95;font-style:italic;"># å·¥ä½œè¿›ç¨‹çš„æœ€å¤§è¿æ¥æ•°é‡, é»˜è®¤1024ä¸ª</span></span>\n<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> worker_connections </span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">2048</span><span style="color:#89DDFF;">;</span></span>\n<span class="line"><span style="color:#A6ACCD;">  </span></span>\n<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#676E95;font-style:italic;"># httpå±‚é¢çš„keep-aliveè¶…æ—¶æ—¶é—´</span></span>\n<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> keepalive_timeout </span><span style="color:#A6ACCD;">60</span><span style="color:#89DDFF;">;</span></span>\n<span class="line"><span style="color:#A6ACCD;">  </span></span>\n<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#676E95;font-style:italic;"># å®¢æˆ·ç«¯è¯·æ±‚å¤´éƒ¨çš„ç¼“å†²åŒºå¤§å°</span></span>\n<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> client_header_buffer_size </span><span style="color:#A6ACCD;">2k</span><span style="color:#89DDFF;">;</span></span>\n<span class="line"><span style="color:#A6ACCD;">}</span></span>\n<span class="line"></span>\n<span class="line"><span style="color:#C792EA;">http</span><span style="color:#A6ACCD;"> { </span><span style="color:#676E95;font-style:italic;"># httpå…¨å±€å—</span></span>\n<span class="line"><span style="color:#A6ACCD;"> </span></span>\n<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> include </span><span style="color:#A6ACCD;">mime.types</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;">  </span><span style="color:#676E95;font-style:italic;"># å¯¼å…¥æ–‡ä»¶æ‰©å±•åä¸æ–‡ä»¶ç±»å‹æ˜ å°„è¡¨</span></span>\n<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> default_type </span><span style="color:#A6ACCD;">application/octet-stream</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;">  </span><span style="color:#676E95;font-style:italic;"># é»˜è®¤æ–‡ä»¶ç±»å‹</span></span>\n<span class="line"><span style="color:#A6ACCD;">  </span></span>\n<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#676E95;font-style:italic;"># æ—¥å¿—æ ¼å¼åŠaccessæ—¥å¿—è·¯å¾„</span></span>\n<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> log_format </span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> main</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">&#39;</span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">remote_addr</span><span style="color:#C3E88D;"> - </span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">remote_user</span><span style="color:#C3E88D;"> [</span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">time_local</span><span style="color:#C3E88D;">]  </span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">status</span><span style="color:#C3E88D;"> &#39;</span></span>\n<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C3E88D;">&#39;&quot;</span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">request</span><span style="color:#C3E88D;">&quot; </span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">body_bytes_sent</span><span style="color:#C3E88D;"> &quot;</span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">http_referer</span><span style="color:#C3E88D;">&quot; &#39;</span></span>\n<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C3E88D;">&#39;&quot;</span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">http_user_agent</span><span style="color:#C3E88D;">&quot; &quot;</span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">http_x_forwarded_for</span><span style="color:#C3E88D;">&quot;&#39;</span><span style="color:#89DDFF;">;</span></span>\n<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> access_log </span><span style="color:#A6ACCD;">  logs/access.log </span><span style="color:#89DDFF;"> main;</span></span>\n<span class="line"><span style="color:#A6ACCD;">  </span></span>\n<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#676E95;font-style:italic;"># å…è®¸sendfileæ–¹å¼ä¼ è¾“æ–‡ä»¶ï¼Œé»˜è®¤ä¸ºoffã€‚</span></span>\n<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> sendfile </span><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> on;</span></span>\n<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> tcp_nopush </span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> on;</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;"># sendfileå¼€å¯æ—¶æ‰å¼€å¯ã€‚</span></span>\n<span class="line"></span>\n<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#676E95;font-style:italic;"># http serverå—</span></span>\n<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#676E95;font-style:italic;"># ç®€å•åå‘ä»£ç†</span></span>\n<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#C792EA;">server</span><span style="color:#A6ACCD;"> {</span></span>\n<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> listen </span><span style="color:#A6ACCD;">      </span><span style="color:#F78C6C;">80</span><span style="color:#89DDFF;">;</span></span>\n<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> server_name </span><span style="color:#A6ACCD;"> domain2.com www.domain2.com</span><span style="color:#89DDFF;">;</span></span>\n<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> access_log </span><span style="color:#A6ACCD;">  logs/domain2.access.log </span><span style="color:#89DDFF;"> main;</span></span>\n<span class="line"><span style="color:#A6ACCD;">   </span></span>\n<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;font-style:italic;"># è½¬å‘åŠ¨æ€è¯·æ±‚åˆ°webåº”ç”¨æœåŠ¡å™¨</span></span>\n<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">location</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">/ </span><span style="color:#A6ACCD;">{</span></span>\n<span class="line"><span style="color:#A6ACCD;">     </span><span style="color:#89DDFF;"> proxy_pass </span><span style="color:#A6ACCD;">     http://127.0.0.1:8000</span><span style="color:#89DDFF;">;</span></span>\n<span class="line"><span style="color:#A6ACCD;">     </span><span style="color:#89DDFF;"> deny </span><span style="color:#A6ACCD;">192.24.40.8</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;">  </span><span style="color:#676E95;font-style:italic;"># æ‹’ç»çš„ip</span></span>\n<span class="line"><span style="color:#A6ACCD;">     </span><span style="color:#89DDFF;"> allow </span><span style="color:#A6ACCD;">192.24.40.6</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;"># å…è®¸çš„ip   </span></span>\n<span class="line"><span style="color:#A6ACCD;">    }</span></span>\n<span class="line"><span style="color:#A6ACCD;">    </span></span>\n<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;font-style:italic;"># é”™è¯¯é¡µé¢</span></span>\n<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> error_page </span><span style="color:#A6ACCD;">  </span><span style="color:#F78C6C;">500</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">502</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">503</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">504</span><span style="color:#A6ACCD;">  /50x.html</span><span style="color:#89DDFF;">;</span></span>\n<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#C792EA;">location</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/50x.html </span><span style="color:#A6ACCD;">{</span></span>\n<span class="line"><span style="color:#A6ACCD;">           </span><span style="color:#89DDFF;"> root </span><span style="color:#A6ACCD;">  html</span><span style="color:#89DDFF;">;</span></span>\n<span class="line"><span style="color:#A6ACCD;">        }</span></span>\n<span class="line"><span style="color:#A6ACCD;">  }</span></span>\n<span class="line"></span>\n<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#676E95;font-style:italic;"># è´Ÿè½½å‡è¡¡</span></span>\n<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#C792EA;">upstream</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">backend_server </span><span style="color:#A6ACCD;">{</span></span>\n<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">server</span><span style="color:#A6ACCD;"> 192.168.0.1:8000 </span><span style="color:#A6ACCD;font-style:italic;">weight</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">5</span><span style="color:#A6ACCD;">; </span><span style="color:#676E95;font-style:italic;"># weightè¶Šé«˜ï¼Œæƒé‡è¶Šå¤§</span></span>\n<span class="line"><span style="color:#A6ACCD;">    server 192.168.0.2:8000 </span><span style="color:#A6ACCD;font-style:italic;">weight</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">;</span></span>\n<span class="line"><span style="color:#A6ACCD;">    server 192.168.0.3:8000;</span></span>\n<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">server</span><span style="color:#A6ACCD;"> 192.168.0.4:8001 backup; </span><span style="color:#676E95;font-style:italic;"># çƒ­å¤‡</span></span>\n<span class="line"><span style="color:#A6ACCD;">  }</span></span>\n<span class="line"></span>\n<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#C792EA;">server</span><span style="color:#A6ACCD;"> {</span></span>\n<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> listen </span><span style="color:#A6ACCD;">         </span><span style="color:#F78C6C;">80</span><span style="color:#89DDFF;">;</span></span>\n<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> server_name </span><span style="color:#A6ACCD;">    big.server.com</span><span style="color:#89DDFF;">;</span></span>\n<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> access_log </span><span style="color:#A6ACCD;">     logs/big.server.access.log</span><span style="color:#89DDFF;"> main;</span></span>\n<span class="line"><span style="color:#A6ACCD;">    </span></span>\n<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> charset </span><span style="color:#A6ACCD;">utf-8</span><span style="color:#89DDFF;">;</span></span>\n<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> client_max_body_size </span><span style="color:#A6ACCD;">10M</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;"># é™åˆ¶ç”¨æˆ·ä¸Šä¼ æ–‡ä»¶å¤§å°ï¼Œé»˜è®¤1M</span></span>\n<span class="line"></span>\n<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">location</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">/ </span><span style="color:#A6ACCD;">{</span></span>\n<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#676E95;font-style:italic;"># ä½¿ç”¨proxy_passè½¬å‘è¯·æ±‚åˆ°é€šè¿‡upstreamå®šä¹‰çš„ä¸€ç»„åº”ç”¨æœåŠ¡å™¨</span></span>\n<span class="line"><span style="color:#A6ACCD;">     </span><span style="color:#89DDFF;"> proxy_pass </span><span style="color:#A6ACCD;">     http://backend_server</span><span style="color:#89DDFF;">;</span></span>\n<span class="line"><span style="color:#A6ACCD;">     </span><span style="color:#89DDFF;"> proxy_set_header </span><span style="color:#A6ACCD;">X-Forwarded-For </span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">proxy_add_x_forwarded_for</span><span style="color:#89DDFF;">;</span></span>\n<span class="line"><span style="color:#A6ACCD;">     </span><span style="color:#89DDFF;"> proxy_set_header </span><span style="color:#A6ACCD;">Host </span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">http_host</span><span style="color:#89DDFF;">;</span></span>\n<span class="line"><span style="color:#A6ACCD;">     </span><span style="color:#89DDFF;"> proxy_redirect </span><span style="color:#A6ACCD;">off</span><span style="color:#89DDFF;">;</span></span>\n<span class="line"><span style="color:#A6ACCD;">     </span><span style="color:#89DDFF;"> proxy_set_header </span><span style="color:#A6ACCD;">X-Real-IP  </span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">remote_addr</span><span style="color:#89DDFF;">;</span></span>\n<span class="line"><span style="color:#A6ACCD;">    }</span></span>\n<span class="line"><span style="color:#A6ACCD;">    </span></span>\n<span class="line"><span style="color:#A6ACCD;">  }</span></span>\n<span class="line"><span style="color:#A6ACCD;">}</span></span>\n<span class="line"></span></code></pre></div><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä»”ç»†åˆ†æä¸‹Nginxå„ä¸ªæ¨¡å—çš„é…ç½®é€‰é¡¹ã€‚</p><h2 id="nginx-locationé…ç½®" tabindex="-1">Nginx Locationé…ç½® <a class="header-anchor" href="#nginx-locationé…ç½®" aria-hidden="true">#</a></h2><p>Nginx Locationé…ç½®æ˜¯Nginxçš„æ ¸å¿ƒé…ç½®ï¼Œå®ƒè´Ÿè´£åŒ¹é…è¯·æ±‚çš„url, å¹¶æ ¹æ®Locationé‡Œå®šä¹‰çš„è§„åˆ™æ¥å¤„ç†è¿™ä¸ªè¯·æ±‚ï¼Œæ¯”å¦‚æ‹’ç»ã€è½¬å‘ã€é‡å®šå‘æˆ–ç›´æ¥æä¾›æ–‡ä»¶ä¸‹è½½ã€‚</p><h2 id="urlåŒ¹é…æ–¹å¼åŠä¼˜å…ˆçº§" tabindex="-1">URLåŒ¹é…æ–¹å¼åŠä¼˜å…ˆçº§ <a class="header-anchor" href="#urlåŒ¹é…æ–¹å¼åŠä¼˜å…ˆçº§" aria-hidden="true">#</a></h2><p>Nginxçš„Locationé…ç½®æ”¯æŒæ™®é€šå­—ç¬¦ä¸²åŒ¹é…å’Œæ­£åˆ™åŒ¹é…ï¼Œä¸è¿‡urlçš„å„ç§åŒ¹é…æ–¹å¼æ˜¯æœ‰ä¼˜å…ˆçº§çš„ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><table><thead><tr><th>åŒ¹é…ç¬¦</th><th>åŒ¹é…è§„åˆ™</th><th>ä¼˜å…ˆçº§</th></tr></thead><tbody><tr><td>=</td><td>ç²¾ç¡®åŒ¹é…</td><td>1</td></tr><tr><td>^~</td><td>ä»¥æŸä¸ªå­—ç¬¦ä¸²å¼€å¤´</td><td>2</td></tr><tr><td>~</td><td>åŒºåˆ†å¤§å°å†™çš„æ­£åˆ™åŒ¹é…</td><td>3</td></tr><tr><td>~*</td><td>ä¸åŒºåˆ†å¤§å°å†™çš„æ­£åˆ™åŒ¹é…</td><td>4</td></tr><tr><td>!~</td><td>åŒºåˆ†å¤§å°å†™çš„ä¸åŒ¹é…æ­£åˆ™</td><td>5</td></tr><tr><td>!~*</td><td>ä¸åŒºåˆ†å¤§å°å†™çš„ä¸åŒ¹é…æ­£åˆ™</td><td>6</td></tr><tr><td>/</td><td>é€šç”¨åŒ¹é…ï¼Œä»»ä½•è¯·æ±‚éƒ½ä¼šåŒ¹é…åˆ°</td><td>7</td></tr></tbody></table><p>ä¸ºäº†åŠ æ·±ä½ çš„ç†è§£ï¼Œæˆ‘ä»¬æ¥çœ‹å¦‚ä¸‹ä¸€ä¸ªä¾‹å­ã€‚ç”±äºè§„åˆ™2çš„ä¼˜å…ˆçº§æ›´é«˜ï¼Œå½“ç”¨æˆ·è®¿é—®<code>/static/</code>æˆ–åˆ™<code>/static/123.html</code>æ—¶ï¼ŒNginxä¼šä¼˜å…ˆæ‰§è¡Œè§„åˆ™2é‡Œçš„æ“ä½œï¼Œå…¶å®ƒçš„çš„è¯·æ±‚åˆ™ä¼šäº¤ç”±è§„åˆ™1æ‰§è¡Œã€‚</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#676E95;font-style:italic;"># è§„åˆ™1ï¼šé€šç”¨åŒ¹é…</span></span>\n<span class="line"><span style="color:#FFCB6B;">location</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">{</span></span>\n<span class="line"><span style="color:#A6ACCD;">}</span></span>\n<span class="line"></span>\n<span class="line"><span style="color:#676E95;font-style:italic;"># è§„åˆ™2ï¼šå¤„ç†ä»¥/static/å¼€å¤´çš„url</span></span>\n<span class="line"><span style="color:#FFCB6B;">location</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">^~</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/static</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">{</span><span style="color:#A6ACCD;">                         </span></span>\n<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#82AAFF;">alias</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/usr/share/nginx/html/static</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;"># é™æ€èµ„æºè·¯å¾„</span></span>\n<span class="line"><span style="color:#A6ACCD;">}</span></span>\n<span class="line"></span></code></pre></div><p><strong>æ³¨æ„</strong>ï¼šä¸Šä¾‹ä¸­æˆ‘ä»¬ä½¿ç”¨äº†<code>alias</code>åˆ«åè®¾ç½®äº†é™æ€æ–‡ä»¶æ‰€åœ¨ç›®å½•ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨<code>root</code>æŒ‡å®šé™æ€æ–‡ä»¶ç›®å½•ã€‚æ³¨æ„ï¼š<code>alias</code>å’Œ<code>root</code>æ˜¯æœ‰åŒºåˆ«çš„ã€‚</p><ul><li><code>root</code>å¯¹è·¯å¾„çš„å¤„ç†ï¼šrootè·¯å¾„ ï¼‹ locationè·¯å¾„</li><li><code>alias</code>å¯¹è·¯å¾„çš„å¤„ç†ï¼šä½¿ç”¨aliasè·¯å¾„æ›¿æ¢locationè·¯å¾„</li></ul><p>å¦‚æœç”¨<code>root</code>è®¾ç½®é™æ€æ–‡ä»¶èµ„æºè·¯å¾„ï¼Œå¯ä»¥æŒ‰å¦‚ä¸‹ä»£ç è®¾ç½®ã€‚ä¸¤è€…æ˜¯ç­‰åŒçš„ã€‚</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#676E95;font-style:italic;"># è§„åˆ™2ï¼šå¤„ç†ä»¥/static/å¼€å¤´çš„url</span></span>\n<span class="line"><span style="color:#FFCB6B;">location</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">^~</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/static</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">{</span><span style="color:#A6ACCD;">                         </span></span>\n<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#FFCB6B;">root</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/usr/share/nginx/html</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;"># é™æ€èµ„æºè·¯å¾„</span></span>\n<span class="line"><span style="color:#A6ACCD;">}</span></span>\n<span class="line"></span></code></pre></div><p>Locationè¿˜æ”¯æŒæ­£åˆ™åŒ¹é…ï¼Œæ¯”å¦‚ä¸‹ä¾‹å¯ä»¥ç¦æ­¢ç”¨æˆ·è®¿é—®æ‰€æœ‰çš„å›¾ç‰‡æ ¼å¼æ–‡ä»¶ã€‚</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#676E95;font-style:italic;"># æ‹’ç»è®¿é—®æ‰€æœ‰å›¾ç‰‡æ ¼å¼æ–‡ä»¶</span></span>\n<span class="line"><span style="color:#FFCB6B;">location</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">~</span><span style="color:#A6ACCD;">*</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">.</span><span style="color:#A6ACCD;">*</span><span style="color:#A6ACCD;">\\.</span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">jpg</span><span style="color:#89DDFF;">|</span><span style="color:#FFCB6B;">gif</span><span style="color:#89DDFF;">|</span><span style="color:#FFCB6B;">png</span><span style="color:#89DDFF;">|</span><span style="color:#FFCB6B;">jpeg</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;">$ </span><span style="color:#C3E88D;">{</span></span>\n<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#FFCB6B;">deny</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">all</span><span style="color:#89DDFF;">;</span></span>\n<span class="line"><span style="color:#A6ACCD;">}</span></span>\n<span class="line"></span></code></pre></div><h2 id="è¯·æ±‚è½¬å‘å’Œé‡å®šå‘" tabindex="-1">è¯·æ±‚è½¬å‘å’Œé‡å®šå‘ <a class="header-anchor" href="#è¯·æ±‚è½¬å‘å’Œé‡å®šå‘" aria-hidden="true">#</a></h2><p>å¦ä¸€ä¸ªæˆ‘ä»¬åœ¨Locationå—é‡Œç»å¸¸é…ç½®çš„å°±æ˜¯è½¬å‘è¯·æ±‚æˆ–é‡å®šå‘ï¼Œå¦‚ä¸‹ä¾‹æ‰€ç¤ºï¼š</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#676E95;font-style:italic;"># è½¬å‘åŠ¨æ€è¯·æ±‚</span></span>\n<span class="line"><span style="color:#FFCB6B;">server</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">{</span><span style="color:#A6ACCD;">  </span></span>\n<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#FFCB6B;">listen</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">80</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;">                                                         </span></span>\n<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#FFCB6B;">server_name</span><span style="color:#A6ACCD;">  </span><span style="color:#C3E88D;">localhost</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;">                                               </span></span>\n<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#FFCB6B;">client_max_body_size</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">1024M</span><span style="color:#89DDFF;">;</span></span>\n<span class="line"></span>\n<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#FFCB6B;">location</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">{</span></span>\n<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#FFCB6B;">proxy_pass</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">http://localhost:</span><span style="color:#F78C6C;">8080</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;">   </span></span>\n<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#FFCB6B;">proxy_set_header</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">Host</span><span style="color:#A6ACCD;"> $host</span><span style="color:#C3E88D;">:</span><span style="color:#A6ACCD;">$server_port</span><span style="color:#89DDFF;">;</span></span>\n<span class="line"><span style="color:#A6ACCD;">    }</span></span>\n<span class="line"><span style="color:#A6ACCD;">}</span></span>\n<span class="line"></span>\n<span class="line"><span style="color:#676E95;font-style:italic;"># httpè¯·æ±‚é‡å®šå‘åˆ°httpsè¯·æ±‚</span></span>\n<span class="line"><span style="color:#FFCB6B;">server</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">{</span></span>\n<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#FFCB6B;">listen</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">80</span><span style="color:#89DDFF;">;</span></span>\n<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#FFCB6B;">server_name</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">domain.com</span><span style="color:#89DDFF;">;</span></span>\n<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">301</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">https://</span><span style="color:#A6ACCD;">$server_name$request_uri</span><span style="color:#89DDFF;">;</span></span>\n<span class="line"><span style="color:#A6ACCD;">}</span></span>\n<span class="line"></span></code></pre></div><p>æ— è®ºæ˜¯è½¬å‘è¯·æ±‚è¿˜æ˜¯é‡å®šå‘ï¼Œæˆ‘ä»¬éƒ½ä½¿ç”¨äº†ä»¥<code>$</code>ç¬¦å·å¼€å¤´çš„å˜é‡ï¼Œè¿™äº›éƒ½æ˜¯Nginxæä¾›çš„å…¨å±€å˜é‡ã€‚å®ƒä»¬çš„å…·ä½“å«ä¹‰å¦‚ä¸‹æ‰€ç¤ºï¼š</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#A6ACCD;">$args, è¯·æ±‚ä¸­çš„å‚æ•°</span><span style="color:#89DDFF;">;</span></span>\n<span class="line"><span style="color:#A6ACCD;">$content_length, HTTPè¯·æ±‚ä¿¡æ¯é‡Œçš„</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Content-Length</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">;</span></span>\n<span class="line"><span style="color:#A6ACCD;">$content_type, è¯·æ±‚ä¿¡æ¯é‡Œçš„</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Content-Type</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">;</span></span>\n<span class="line"><span style="color:#A6ACCD;">$document_root, é’ˆå¯¹å½“å‰è¯·æ±‚çš„æ ¹è·¯å¾„è®¾ç½®å€¼</span><span style="color:#89DDFF;">;</span></span>\n<span class="line"><span style="color:#A6ACCD;">$document_uri, ä¸$uriç›¸åŒ</span><span style="color:#89DDFF;">;</span></span>\n<span class="line"><span style="color:#A6ACCD;">$host, è¯·æ±‚ä¿¡æ¯ä¸­çš„</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Host</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">ï¼Œå¦‚æœè¯·æ±‚ä¸­æ²¡æœ‰Hostè¡Œï¼Œåˆ™ç­‰äºè®¾ç½®çš„æœåŠ¡å™¨å</span><span style="color:#89DDFF;">;</span></span>\n<span class="line"><span style="color:#A6ACCD;">$limit_rate, å¯¹è¿æ¥é€Ÿç‡çš„é™åˆ¶</span><span style="color:#89DDFF;">;</span></span>\n<span class="line"><span style="color:#A6ACCD;">$request_method, è¯·æ±‚çš„æ–¹æ³•ï¼Œæ¯”å¦‚</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">GET</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">ã€</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">POST</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">ç­‰</span><span style="color:#89DDFF;">;</span></span>\n<span class="line"><span style="color:#A6ACCD;">$remote_addr, å®¢æˆ·ç«¯åœ°å€</span><span style="color:#89DDFF;">;</span></span>\n<span class="line"><span style="color:#A6ACCD;">$remote_port, å®¢æˆ·ç«¯ç«¯å£å·</span><span style="color:#89DDFF;">;</span></span>\n<span class="line"><span style="color:#A6ACCD;">$remote_user, å®¢æˆ·ç«¯ç”¨æˆ·åï¼Œè®¤è¯ç”¨</span><span style="color:#89DDFF;">;</span></span>\n<span class="line"><span style="color:#A6ACCD;">$request_filename, å½“å‰è¯·æ±‚çš„æ–‡ä»¶è·¯å¾„å</span></span>\n<span class="line"><span style="color:#A6ACCD;">$request_body_file,å½“å‰è¯·æ±‚çš„æ–‡ä»¶</span></span>\n<span class="line"><span style="color:#A6ACCD;">$request_uri, è¯·æ±‚çš„URIï¼Œå¸¦æŸ¥è¯¢å­—ç¬¦ä¸²</span><span style="color:#89DDFF;">;</span></span>\n<span class="line"><span style="color:#A6ACCD;">$query_string, ä¸$argsç›¸åŒ</span><span style="color:#89DDFF;">;</span></span>\n<span class="line"><span style="color:#A6ACCD;">$scheme, æ‰€ç”¨çš„åè®®ï¼Œæ¯”å¦‚httpæˆ–è€…æ˜¯httpsï¼Œæ¯”å¦‚rewrite ^</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">.</span><span style="color:#FFCB6B;">+</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;">$ $scheme://example.com</span><span style="color:#A6ACCD;font-style:italic;">$1</span><span style="color:#A6ACCD;"> redirect</span><span style="color:#89DDFF;">;</span></span>\n<span class="line"><span style="color:#A6ACCD;">$server_protocol, è¯·æ±‚çš„åè®®ç‰ˆæœ¬ï¼Œ</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">HTTP/1.0</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">æˆ–</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">HTTP/1.1</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">;</span></span>\n<span class="line"><span style="color:#A6ACCD;">$server_addr, æœåŠ¡å™¨åœ°å€</span><span style="color:#89DDFF;">;</span></span>\n<span class="line"><span style="color:#A6ACCD;">$server_name, è¯·æ±‚åˆ°è¾¾çš„æœåŠ¡å™¨å</span><span style="color:#89DDFF;">;</span></span>\n<span class="line"><span style="color:#A6ACCD;">$server_port, è¯·æ±‚åˆ°è¾¾çš„æœåŠ¡å™¨ç«¯å£å·</span><span style="color:#89DDFF;">;</span></span>\n<span class="line"><span style="color:#A6ACCD;">$uri, è¯·æ±‚çš„URIï¼Œå¯èƒ½å’Œæœ€åˆçš„å€¼æœ‰ä¸åŒï¼Œæ¯”å¦‚ç»è¿‡é‡å®šå‘ä¹‹ç±»çš„ã€‚</span></span>\n<span class="line"></span></code></pre></div><p>çŸ¥é“è¿™äº›å…¨å±€å˜é‡çš„å«ä¹‰åï¼Œæˆ‘ä»¬å°±å¯ä»¥é™åˆ¶ç”¨æˆ·çš„è¯·æ±‚æ–¹æ³•ã€‚æ¯”å¦‚ä¸‹ä¾‹ä¸­é…ç½®äº†åªå…è®¸ç”¨æˆ·é€šè¿‡POSTæ–¹æ³•è®¿é—®ï¼Œå…¶ä»–çš„è¯·æ±‚æ–¹æ³•åˆ™è¿”å›405ã€‚</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">$request_method </span><span style="color:#89DDFF;">!</span><span style="color:#FFCB6B;">~</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">^</span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">GET</span><span style="color:#89DDFF;">|</span><span style="color:#FFCB6B;">POST</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;">$ </span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">405</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">}</span></span>\n<span class="line"></span></code></pre></div><h2 id="nginxé™æ€æ–‡ä»¶é…ç½®" tabindex="-1">Nginxé™æ€æ–‡ä»¶é…ç½® <a class="header-anchor" href="#nginxé™æ€æ–‡ä»¶é…ç½®" aria-hidden="true">#</a></h2><p>Nginxå¯ç›´æ¥ä½œä¸ºå¼ºå¤§çš„é™æ€æ–‡ä»¶æœåŠ¡å™¨ä½¿ç”¨ï¼Œæ”¯æŒå¯¹é™æ€æ–‡ä»¶è¿›è¡Œç¼“å­˜è¿˜å¯ä»¥ç›´æ¥å°†Nginxä½œä¸ºæ–‡ä»¶ä¸‹è½½æœåŠ¡å™¨ä½¿ç”¨ã€‚</p><h2 id="é™æ€æ–‡ä»¶ç¼“å­˜" tabindex="-1">é™æ€æ–‡ä»¶ç¼“å­˜ <a class="header-anchor" href="#é™æ€æ–‡ä»¶ç¼“å­˜" aria-hidden="true">#</a></h2><p>ç¼“å­˜å¯ä»¥åŠ å¿«ä¸‹æ¬¡é™æ€æ–‡ä»¶åŠ è½½é€Ÿåº¦ã€‚æˆ‘ä»¬å¾ˆå¤šä¸ç½‘ç«™æ ·å¼ç›¸å…³çš„æ–‡ä»¶æ¯”å¦‚csså’Œjsæ–‡ä»¶ä¸€èˆ¬ä¸æ€ä¹ˆå˜åŒ–ï¼Œç¼“å­˜æœ‰æ•ˆå™¨å¯ä»¥é€šè¿‡<code>expires</code>é€‰é¡¹è®¾ç½®å¾—é•¿ä¸€äº›ã€‚</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;font-style:italic;"># ä½¿ç”¨expiresé€‰é¡¹å¼€å¯é™æ€æ–‡ä»¶ç¼“å­˜ï¼Œ10å¤©æœ‰æ•ˆ</span></span>\n<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#FFCB6B;">location</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">~</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">^/</span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">images</span><span style="color:#89DDFF;">|</span><span style="color:#FFCB6B;">javascript</span><span style="color:#89DDFF;">|</span><span style="color:#FFCB6B;">js</span><span style="color:#89DDFF;">|</span><span style="color:#FFCB6B;">css</span><span style="color:#89DDFF;">|</span><span style="color:#FFCB6B;">flash</span><span style="color:#89DDFF;">|</span><span style="color:#FFCB6B;">media</span><span style="color:#89DDFF;">|</span><span style="color:#FFCB6B;">static</span><span style="color:#89DDFF;">)</span><span style="color:#C3E88D;">/</span><span style="color:#A6ACCD;">  </span><span style="color:#C3E88D;">{</span></span>\n<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#FFCB6B;">root</span><span style="color:#A6ACCD;">    </span><span style="color:#C3E88D;">/var/www/big.server.com/static_files</span><span style="color:#89DDFF;">;</span></span>\n<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#FFCB6B;">expires</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">10d</span><span style="color:#89DDFF;">;</span></span>\n<span class="line"><span style="color:#A6ACCD;">    }</span></span>\n<span class="line"></span></code></pre></div><h2 id="é™æ€æ–‡ä»¶å‹ç¼©" tabindex="-1">é™æ€æ–‡ä»¶å‹ç¼© <a class="header-anchor" href="#é™æ€æ–‡ä»¶å‹ç¼©" aria-hidden="true">#</a></h2><p>Nginxå¯ä»¥å¯¹ç½‘ç«™çš„cssã€js ã€xmlã€html æ–‡ä»¶åœ¨ä¼ è¾“å‰è¿›è¡Œå‹ç¼©ï¼Œå¤§å¹…æé«˜é¡µé¢åŠ è½½é€Ÿåº¦ã€‚ç»è¿‡Gzipå‹ç¼©åé¡µé¢å¤§å°å¯ä»¥å˜ä¸ºåŸæ¥çš„30%ç”šè‡³æ›´å°ã€‚ä½¿ç”¨æ—¶ä»…éœ€å¼€å¯Gzipå‹ç¼©åŠŸèƒ½å³å¯ã€‚ä½ å¯ä»¥åœ¨httpå…¨å±€å—æˆ–serverå—å¢åŠ è¿™ä¸ªé…ç½®ã€‚</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">http</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">{</span></span>\n<span class="line"><span style="color:#A6ACCD;">    </span></span>\n<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;font-style:italic;"># å¼€å¯gzipå‹ç¼©åŠŸèƒ½</span></span>\n<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#FFCB6B;">gzip</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">on</span><span style="color:#89DDFF;">;</span></span>\n<span class="line"><span style="color:#A6ACCD;">    </span></span>\n<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;font-style:italic;"># è®¾ç½®å…è®¸å‹ç¼©çš„é¡µé¢æœ€å°å­—èŠ‚æ•°; è¿™é‡Œè¡¨ç¤ºå¦‚æœæ–‡ä»¶å°äº10kï¼Œå‹ç¼©æ²¡æœ‰æ„ä¹‰.</span></span>\n<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#FFCB6B;">gzip_min_length</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">10k</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span></span>\n<span class="line"><span style="color:#A6ACCD;">    </span></span>\n<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;font-style:italic;"># è®¾ç½®å‹ç¼©æ¯”ç‡ï¼Œæœ€å°ä¸º1ï¼Œå¤„ç†é€Ÿåº¦å¿«ï¼Œä¼ è¾“é€Ÿåº¦æ…¢ï¼›</span></span>\n<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;font-style:italic;"># 9ä¸ºæœ€å¤§å‹ç¼©æ¯”ï¼Œå¤„ç†é€Ÿåº¦æ…¢ï¼Œä¼ è¾“é€Ÿåº¦å¿«; æ¨è6</span></span>\n<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#FFCB6B;">gzip_comp_level</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">6</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span></span>\n<span class="line"><span style="color:#A6ACCD;">    </span></span>\n<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;font-style:italic;"># è®¾ç½®å‹ç¼©ç¼“å†²åŒºå¤§å°ï¼Œæ­¤å¤„è®¾ç½®ä¸º16ä¸ª8Kå†…å­˜ä½œä¸ºå‹ç¼©ç»“æœç¼“å†²</span></span>\n<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#FFCB6B;">gzip_buffers</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">16</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">8k</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span></span>\n<span class="line"><span style="color:#A6ACCD;">    </span></span>\n<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;font-style:italic;"># è®¾ç½®å“ªäº›æ–‡ä»¶éœ€è¦å‹ç¼©,ä¸€èˆ¬æ–‡æœ¬ï¼Œcsså’Œjså»ºè®®å‹ç¼©ã€‚å›¾ç‰‡è§†éœ€è¦è¦é”ã€‚</span></span>\n<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#FFCB6B;">gzip_types</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">text/plain</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">text/css</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">application/json</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">application/x-javascript</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">text/xml</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">application/xml</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">application/xml+rss</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">text/javascript</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span></span>\n<span class="line"><span style="color:#A6ACCD;">    </span></span>\n<span class="line"><span style="color:#A6ACCD;">} </span></span>\n<span class="line"></span></code></pre></div><h2 id="æ–‡ä»¶ä¸‹è½½æœåŠ¡å™¨" tabindex="-1">æ–‡ä»¶ä¸‹è½½æœåŠ¡å™¨ <a class="header-anchor" href="#æ–‡ä»¶ä¸‹è½½æœåŠ¡å™¨" aria-hidden="true">#</a></h2><p>Nginxä¹Ÿå¯ç›´æ¥åšæ–‡ä»¶ä¸‹è½½æœåŠ¡å™¨ä½¿ç”¨ï¼Œåœ¨locationå—è®¾ç½®<code>autoindex</code>ç›¸å…³é€‰é¡¹å³å¯ã€‚</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">server</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">{</span></span>\n<span class="line"></span>\n<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#FFCB6B;">listen</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">80</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">default_server</span><span style="color:#89DDFF;">;</span></span>\n<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#FFCB6B;">listen</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">::</span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;">:80 </span><span style="color:#C3E88D;">default_server</span><span style="color:#89DDFF;">;</span></span>\n<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#FFCB6B;">server_name</span><span style="color:#A6ACCD;">  </span><span style="color:#C3E88D;">_</span><span style="color:#89DDFF;">;</span></span>\n<span class="line"><span style="color:#A6ACCD;">    </span></span>\n<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#FFCB6B;">location</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/download</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">{</span><span style="color:#A6ACCD;">    </span></span>\n<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#676E95;font-style:italic;"># ä¸‹è½½æ–‡ä»¶æ‰€åœ¨ç›®å½•</span></span>\n<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#FFCB6B;">root</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/usr/share/nginx/html</span><span style="color:#89DDFF;">;</span></span>\n<span class="line"><span style="color:#A6ACCD;">        </span></span>\n<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#676E95;font-style:italic;"># å¼€å¯ç´¢å¼•åŠŸèƒ½</span></span>\n<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#FFCB6B;">autoindex</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">on</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;">  </span></span>\n<span class="line"><span style="color:#A6ACCD;">        </span></span>\n<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#676E95;font-style:italic;"># å…³é—­è®¡ç®—æ–‡ä»¶ç¡®åˆ‡å¤§å°ï¼ˆå•ä½bytesï¼‰ï¼Œåªæ˜¾ç¤ºå¤§æ¦‚å¤§å°ï¼ˆå•ä½kbã€mbã€gbï¼‰</span></span>\n<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#FFCB6B;">autoindex_exact_size</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">off</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span></span>\n<span class="line"><span style="color:#A6ACCD;">        </span></span>\n<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#676E95;font-style:italic;">#æ˜¾ç¤ºæœ¬æœºæ—¶é—´è€Œé GMT æ—¶é—´</span></span>\n<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#FFCB6B;">autoindex_localtime</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">on</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;">   </span></span>\n<span class="line"><span style="color:#A6ACCD;">                </span></span>\n<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#676E95;font-style:italic;"># å¯¹äºtxtå’Œjpgæ–‡ä»¶ï¼Œå¼ºåˆ¶ä»¥é™„ä»¶å½¢å¼ä¸‹è½½ï¼Œä¸è¦æµè§ˆå™¨ç›´æ¥æ‰“å¼€</span></span>\n<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">$request_filename </span><span style="color:#89DDFF;">~*</span><span style="color:#A6ACCD;"> ^.</span><span style="color:#89DDFF;">*?</span><span style="color:#A6ACCD;">\\.</span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">txt</span><span style="color:#89DDFF;">|</span><span style="color:#FFCB6B;">jpg</span><span style="color:#89DDFF;">|</span><span style="color:#FFCB6B;">png</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;">$</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>\n<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#FFCB6B;">add_header</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">Content-Disposition</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">attachment</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>\n<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">}</span></span>\n<span class="line"><span style="color:#A6ACCD;">    }</span></span>\n<span class="line"><span style="color:#A6ACCD;">}</span></span>\n<span class="line"></span></code></pre></div><h2 id="nginxé…ç½®https" tabindex="-1">Nginxé…ç½®HTTPS <a class="header-anchor" href="#nginxé…ç½®https" aria-hidden="true">#</a></h2><div class="language-nginx"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#676E95;font-style:italic;"># è´Ÿè½½å‡è¡¡ï¼Œè®¾ç½®HTTPS</span></span>\n<span class="line"><span style="color:#C792EA;">upstream</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">backend_server </span><span style="color:#A6ACCD;">{</span></span>\n<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">server</span><span style="color:#A6ACCD;"> APP_SERVER_1_IP;</span></span>\n<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">server</span><span style="color:#A6ACCD;"> APP_SERVER_2_IP;</span></span>\n<span class="line"><span style="color:#A6ACCD;">}</span></span>\n<span class="line"></span>\n<span class="line"><span style="color:#676E95;font-style:italic;"># ç¦æ­¢æœªç»‘å®šåŸŸåè®¿é—®ï¼Œæ¯”å¦‚é€šè¿‡ipåœ°å€è®¿é—®</span></span>\n<span class="line"><span style="color:#676E95;font-style:italic;"># 444:è¯¥ç½‘é¡µæ— æ³•æ­£å¸¸è¿ä½œï¼Œæœªå‘é€ä»»ä½•æ•°æ®</span></span>\n<span class="line"><span style="color:#C792EA;">server</span><span style="color:#A6ACCD;"> {</span></span>\n<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> listen </span><span style="color:#A6ACCD;">80</span><span style="color:#89DDFF;"> default_server;</span></span>\n<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> server_name </span><span style="color:#A6ACCD;">_</span><span style="color:#89DDFF;">;</span></span>\n<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">444</span><span style="color:#A6ACCD;">;</span></span>\n<span class="line"><span style="color:#A6ACCD;">}</span></span>\n<span class="line"></span>\n<span class="line"><span style="color:#676E95;font-style:italic;"># HTTPè¯·æ±‚é‡å®šå‘è‡³HTTPSè¯·æ±‚</span></span>\n<span class="line"><span style="color:#C792EA;">server</span><span style="color:#A6ACCD;"> {</span></span>\n<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> listen </span><span style="color:#A6ACCD;">80</span><span style="color:#89DDFF;">;</span></span>\n<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> listen </span><span style="color:#A6ACCD;">[::]:80</span><span style="color:#89DDFF;">;</span></span>\n<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> server_name </span><span style="color:#A6ACCD;">your_domain.com</span><span style="color:#89DDFF;">;</span></span>\n<span class="line"><span style="color:#A6ACCD;">    </span></span>\n<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">location</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">/ </span><span style="color:#A6ACCD;">{</span></span>\n<span class="line"><span style="color:#A6ACCD;">       </span><span style="color:#89DDFF;"> proxy_set_header </span><span style="color:#A6ACCD;">X-Forwarded-For </span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">proxy_add_x_forwarded_for</span><span style="color:#89DDFF;">;</span></span>\n<span class="line"><span style="color:#A6ACCD;">       </span><span style="color:#89DDFF;"> proxy_set_header </span><span style="color:#A6ACCD;">X-Forwarded-Proto </span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">scheme</span><span style="color:#89DDFF;">;</span></span>\n<span class="line"><span style="color:#A6ACCD;">       </span><span style="color:#89DDFF;"> proxy_set_header </span><span style="color:#A6ACCD;">Host </span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">http_host</span><span style="color:#89DDFF;">;</span></span>\n<span class="line"><span style="color:#A6ACCD;">       </span><span style="color:#89DDFF;"> proxy_redirect </span><span style="color:#A6ACCD;">off</span><span style="color:#89DDFF;">;</span></span>\n<span class="line"><span style="color:#A6ACCD;">       </span><span style="color:#89DDFF;"> proxy_pass </span><span style="color:#A6ACCD;">http://backend_server</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span></span>\n<span class="line"><span style="color:#A6ACCD;">     }</span></span>\n<span class="line"><span style="color:#A6ACCD;">    </span></span>\n<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">301</span><span style="color:#A6ACCD;"> https://</span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">server_name</span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">request_uri;</span></span>\n<span class="line"><span style="color:#A6ACCD;">}</span></span>\n<span class="line"></span>\n<span class="line"><span style="color:#C792EA;">server</span><span style="color:#A6ACCD;"> {</span></span>\n<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> listen </span><span style="color:#A6ACCD;">443 ssl http2</span><span style="color:#89DDFF;">;</span></span>\n<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> listen </span><span style="color:#A6ACCD;">[::]:443 ssl http2</span><span style="color:#89DDFF;">;</span></span>\n<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> server_name </span><span style="color:#A6ACCD;">your_domain.com</span><span style="color:#89DDFF;">;</span></span>\n<span class="line"></span>\n<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;font-style:italic;"># sslè¯ä¹¦åŠå¯†é’¥è·¯å¾„</span></span>\n<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> ssl_certificate </span><span style="color:#A6ACCD;">/path/to/your/fullchain.pem</span><span style="color:#89DDFF;">;</span></span>\n<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> ssl_certificate_key </span><span style="color:#A6ACCD;">/path/to/your/privkey.pem</span><span style="color:#89DDFF;">;</span></span>\n<span class="line"></span>\n<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;font-style:italic;"># SSLä¼šè¯ä¿¡æ¯</span></span>\n<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> client_max_body_size </span><span style="color:#A6ACCD;">75MB</span><span style="color:#89DDFF;">;</span></span>\n<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> keepalive_timeout </span><span style="color:#A6ACCD;">10</span><span style="color:#89DDFF;">;</span></span>\n<span class="line"></span>\n<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">location</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">/ </span><span style="color:#A6ACCD;">{</span></span>\n<span class="line"><span style="color:#A6ACCD;">       </span><span style="color:#89DDFF;"> proxy_set_header </span><span style="color:#A6ACCD;">X-Forwarded-For </span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">proxy_add_x_forwarded_for</span><span style="color:#89DDFF;">;</span></span>\n<span class="line"><span style="color:#A6ACCD;">       </span><span style="color:#89DDFF;"> proxy_set_header </span><span style="color:#A6ACCD;">X-Forwarded-Proto </span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">scheme</span><span style="color:#89DDFF;">;</span></span>\n<span class="line"><span style="color:#A6ACCD;">       </span><span style="color:#89DDFF;"> proxy_set_header </span><span style="color:#A6ACCD;">Host </span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">http_host</span><span style="color:#89DDFF;">;</span></span>\n<span class="line"><span style="color:#A6ACCD;">       </span><span style="color:#89DDFF;"> proxy_redirect </span><span style="color:#A6ACCD;">off</span><span style="color:#89DDFF;">;</span></span>\n<span class="line"><span style="color:#A6ACCD;">       </span><span style="color:#89DDFF;"> proxy_pass </span><span style="color:#A6ACCD;">http://django</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;"># Django+uwsgiä¸åœ¨æœ¬æœºä¸Šï¼Œä½¿ç”¨ä»£ç†è½¬å‘</span></span>\n<span class="line"><span style="color:#A6ACCD;">    }</span></span>\n<span class="line"></span>\n<span class="line"><span style="color:#A6ACCD;">}</span></span>\n<span class="line"></span></code></pre></div><h2 id="nginxæ—¥å¿—é…ç½®" tabindex="-1">Nginxæ—¥å¿—é…ç½® <a class="header-anchor" href="#nginxæ—¥å¿—é…ç½®" aria-hidden="true">#</a></h2><p>Nginxçš„æ—¥å¿—ä¸»è¦åŒ…æ‹¬è®¿é—®æ—¥å¿—<code>access_log</code>å’Œé”™è¯¯æ—¥å¿—<code>error_log</code>ï¼Œä½ è¿˜å¯ä»¥é€šè¿‡<code>log_format</code>å®šä¹‰æ—¥å¿—æ ¼å¼ã€‚ä½ å¯ä»¥åœ¨å…¨å±€å—ï¼ŒServerå—æˆ–Locationå—å®šä¹‰æ—¥å¿—ã€‚æ¯”å¦‚ä¸‹ä¾‹åœ¨httpå—ä¸­å®šä¹‰äº†ä¸€ä¸ªåä¸º<code>main</code>çš„æ—¥å¿—æ ¼å¼ï¼Œæ‰€æœ‰ç«™ç‚¹çš„æ—¥å¿—éƒ½ä¼šæŒ‰è¿™ä¸ªæ ¼å¼è®°å½•ã€‚</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">http</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">{</span></span>\n<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;"># æ—¥å¿—æ ¼å¼åŠaccessæ—¥å¿—è·¯å¾„</span></span>\n<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#FFCB6B;">log_format</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">main</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">$remote_addr - $remote_user [$time_local]  $status </span><span style="color:#89DDFF;">&#39;</span></span>\n<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#FFCB6B;">&#39;&quot;</span><span style="color:#A6ACCD;">$request</span><span style="color:#FFCB6B;">&quot;</span><span style="color:#A6ACCD;"> $body_bytes_sent </span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">$http_referer</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span></span>\n<span class="line"><span style="color:#C3E88D;">    </span><span style="color:#89DDFF;">&#39;&quot;</span><span style="color:#A6ACCD;">$http_user_agent</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">$http_x_forwarded_for</span><span style="color:#89DDFF;">&quot;&#39;</span><span style="color:#C3E88D;">;</span></span>\n<span class="line"><span style="color:#C3E88D;">  access_log   logs/access.log  main;</span></span>\n<span class="line"><span style="color:#C3E88D;">}</span></span>\n<span class="line"></span></code></pre></div><p><code>access_log</code>æ–‡ä»¶éšç€è®¿é—®è®°å½•å¢å¤šæœ‰å¯èƒ½å˜å¾—éå¸¸å¤§ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>access_log off</code>å…³é—­ä¸€äº›ä¸éœ€è¦è®°å½•çš„è®¿é—®ã€‚æ¯”å¦‚å½“ä¸€ä¸ªç«™ç‚¹æ²¡æœ‰è®¾ç½®favicon.icoæ—¶ï¼Œ<code>access_log</code>ä¼šè®°å½•äº†å¤§é‡favicon.ico 404ä¿¡æ¯, è¿™æ˜¯æ²¡æœ‰å¿…è¦çš„, å¯ä»¥æŒ‰å¦‚ä¸‹æ–¹å¼å…³é—­è®¿é—®æ—¥å¿—è®°å½•ã€‚</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">location</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/favicon.ico</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">{</span></span>\n<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#FFCB6B;">log_not_found</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">off</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span></span>\n<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#FFCB6B;">access_log</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">off</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;"># ä¸åœ¨access_logè®°å½•è¯¥é¡¹è®¿é—®</span></span>\n<span class="line"><span style="color:#A6ACCD;">}</span></span>\n<span class="line"></span></code></pre></div><h2 id="nginxè¶…æ—¶è®¾ç½®" tabindex="-1">Nginxè¶…æ—¶è®¾ç½® <a class="header-anchor" href="#nginxè¶…æ—¶è®¾ç½®" aria-hidden="true">#</a></h2><p>Nginxæä¾›äº†å¾ˆå¤šè¶…æ—¶è®¾ç½®é€‰é¡¹ï¼Œç›®çš„æ˜¯ä¿æŠ¤æœåŠ¡å™¨èµ„æºï¼ŒCPUï¼Œå†…å­˜å¹¶æ§åˆ¶è¿æ¥æ•°ã€‚ä½ å¯ä»¥æ ¹æ®å®é™…é¡¹ç›®éœ€æ±‚åœ¨å…¨å±€å—ã€Serverå—å’ŒLocationå—è¿›è¡Œé…ç½®ã€‚</p><h2 id="è¯·æ±‚è¶…æ—¶è®¾ç½®" tabindex="-1">è¯·æ±‚è¶…æ—¶è®¾ç½® <a class="header-anchor" href="#è¯·æ±‚è¶…æ—¶è®¾ç½®" aria-hidden="true">#</a></h2><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#676E95;font-style:italic;"># å®¢æˆ·ç«¯è¿æ¥ä¿æŒä¼šè¯è¶…æ—¶æ—¶é—´ï¼Œè¶…è¿‡è¿™ä¸ªæ—¶é—´ï¼ŒæœåŠ¡å™¨æ–­å¼€è¿™ä¸ªé“¾æ¥ã€‚</span></span>\n<span class="line"><span style="color:#FFCB6B;">keepalive_timeout</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">60</span><span style="color:#89DDFF;">;</span></span>\n<span class="line"></span>\n<span class="line"><span style="color:#676E95;font-style:italic;"># è®¾ç½®è¯·æ±‚å¤´çš„è¶…æ—¶æ—¶é—´ï¼Œå¯ä»¥è®¾ç½®ä½ç‚¹ã€‚</span></span>\n<span class="line"><span style="color:#676E95;font-style:italic;"># å¦‚æœè¶…è¿‡è¿™ä¸ªæ—¶é—´æ²¡æœ‰å‘é€ä»»ä½•æ•°æ®ï¼Œnginxå°†è¿”å›request time outçš„é”™è¯¯ã€‚</span></span>\n<span class="line"><span style="color:#FFCB6B;">client_header_timeout</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">15</span><span style="color:#89DDFF;">;</span></span>\n<span class="line"></span>\n<span class="line"><span style="color:#676E95;font-style:italic;"># è®¾ç½®è¯·æ±‚ä½“çš„è¶…æ—¶æ—¶é—´ï¼Œå¯ä»¥è®¾ç½®ä½ç‚¹ã€‚</span></span>\n<span class="line"><span style="color:#676E95;font-style:italic;"># å¦‚æœè¶…è¿‡è¿™ä¸ªæ—¶é—´æ²¡æœ‰å‘é€ä»»ä½•æ•°æ®ï¼Œnginxå°†è¿”å›request time outçš„é”™è¯¯ã€‚</span></span>\n<span class="line"><span style="color:#FFCB6B;">client_body_timeout</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">15</span><span style="color:#89DDFF;">;</span></span>\n<span class="line"></span>\n<span class="line"><span style="color:#676E95;font-style:italic;"># å“åº”å®¢æˆ·ç«¯è¶…æ—¶æ—¶é—´</span></span>\n<span class="line"><span style="color:#676E95;font-style:italic;"># å¦‚æœè¶…è¿‡è¿™ä¸ªæ—¶é—´ï¼Œå®¢æˆ·ç«¯æ²¡æœ‰ä»»ä½•æ´»åŠ¨ï¼Œnginxå…³é—­è¿æ¥ã€‚</span></span>\n<span class="line"><span style="color:#FFCB6B;">send_timeout</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">15</span><span style="color:#89DDFF;">;</span></span>\n<span class="line"></span>\n<span class="line"><span style="color:#676E95;font-style:italic;"># ä¸Šä¼ æ–‡ä»¶å¤§å°é™åˆ¶</span></span>\n<span class="line"><span style="color:#FFCB6B;">client_max_body_size</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">10m</span><span style="color:#89DDFF;">;</span></span>\n<span class="line"></span>\n<span class="line"><span style="color:#676E95;font-style:italic;"># ä¹Ÿæ˜¯é˜²æ­¢ç½‘ç»œé˜»å¡ï¼Œä¸è¿‡è¦åŒ…æ¶µåœ¨keepalivedå‚æ•°æ‰æœ‰æ•ˆã€‚</span></span>\n<span class="line"><span style="color:#FFCB6B;">tcp_nodelay</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">on</span><span style="color:#89DDFF;">;</span></span>\n<span class="line"></span>\n<span class="line"><span style="color:#676E95;font-style:italic;"># å®¢æˆ·ç«¯è¯·æ±‚å¤´éƒ¨çš„ç¼“å†²åŒºå¤§å°ï¼Œè¿™ä¸ªå¯ä»¥æ ¹æ®ä½ çš„ç³»ç»Ÿåˆ†é¡µå¤§å°æ¥è®¾ç½®ã€‚</span></span>\n<span class="line"><span style="color:#676E95;font-style:italic;"># ä¸€èˆ¬ä¸€ä¸ªè¯·æ±‚å¤´çš„å¤§å°ä¸ä¼šè¶…è¿‡ 1kï¼Œä¸è¿‡ç”±äºä¸€èˆ¬ç³»ç»Ÿåˆ†é¡µéƒ½è¦å¤§äº1k</span></span>\n<span class="line"><span style="color:#FFCB6B;">client_header_buffer_size</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">2k</span><span style="color:#89DDFF;">;</span></span>\n<span class="line"></span>\n<span class="line"><span style="color:#676E95;font-style:italic;"># è¿™ä¸ªå°†ä¸ºæ‰“å¼€æ–‡ä»¶æŒ‡å®šç¼“å­˜ï¼Œé»˜è®¤æ˜¯æ²¡æœ‰å¯ç”¨çš„ã€‚</span></span>\n<span class="line"><span style="color:#676E95;font-style:italic;"># maxæŒ‡å®šç¼“å­˜æ•°é‡ï¼Œå»ºè®®å’Œæ‰“å¼€æ–‡ä»¶æ•°ä¸€è‡´ï¼Œinactive æ˜¯æŒ‡ç»è¿‡å¤šé•¿æ—¶é—´æ–‡ä»¶æ²¡è¢«è¯·æ±‚ååˆ é™¤ç¼“å­˜ã€‚</span></span>\n<span class="line"><span style="color:#FFCB6B;">open_file_cache</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">max=</span><span style="color:#F78C6C;">102400</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">inactive=20s</span><span style="color:#89DDFF;">;</span></span>\n<span class="line"></span>\n<span class="line"><span style="color:#676E95;font-style:italic;"># è¿™ä¸ªæ˜¯æŒ‡å¤šé•¿æ—¶é—´æ£€æŸ¥ä¸€æ¬¡ç¼“å­˜çš„æœ‰æ•ˆä¿¡æ¯ã€‚</span></span>\n<span class="line"><span style="color:#FFCB6B;">open_file_cache_valid</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">30s</span><span style="color:#89DDFF;">;</span></span>\n<span class="line"></span>\n<span class="line"><span style="color:#676E95;font-style:italic;"># å‘Šè¯‰nginxå…³é—­ä¸å“åº”çš„å®¢æˆ·ç«¯è¿æ¥ã€‚è¿™å°†ä¼šé‡Šæ”¾é‚£ä¸ªå®¢æˆ·ç«¯æ‰€å æœ‰çš„å†…å­˜ç©ºé—´ã€‚</span></span>\n<span class="line"><span style="color:#FFCB6B;">reset_timedout_connection</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">on</span><span style="color:#89DDFF;">;</span></span>\n<span class="line"></span></code></pre></div><h2 id="proxyåå‘ä»£ç†è¶…æ—¶è®¾ç½®" tabindex="-1">Proxyåå‘ä»£ç†è¶…æ—¶è®¾ç½® <a class="header-anchor" href="#proxyåå‘ä»£ç†è¶…æ—¶è®¾ç½®" aria-hidden="true">#</a></h2><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#676E95;font-style:italic;"># è¯¥æŒ‡ä»¤è®¾ç½®ä¸upstreamæœåŠ¡å™¨çš„è¿æ¥è¶…æ—¶æ—¶é—´ï¼Œè¿™ä¸ªè¶…æ—¶å»ºè®®ä¸è¶…è¿‡75ç§’ã€‚</span></span>\n<span class="line"><span style="color:#FFCB6B;">proxy_connect_timeout</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">60</span><span style="color:#89DDFF;">;</span></span>\n<span class="line"></span>\n<span class="line"><span style="color:#676E95;font-style:italic;"># è¯¥æŒ‡ä»¤è®¾ç½®åº”ç”¨æœåŠ¡å™¨çš„å“åº”è¶…æ—¶æ—¶é—´ï¼Œé»˜è®¤60ç§’ã€‚</span></span>\n<span class="line"><span style="color:#FFCB6B;">proxy_read_timeout</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">60</span><span style="color:#C3E88D;">ï¼›</span></span>\n<span class="line"></span>\n<span class="line"><span style="color:#676E95;font-style:italic;"># è®¾ç½®äº†å‘é€è¯·æ±‚ç»™upstreamæœåŠ¡å™¨çš„è¶…æ—¶æ—¶é—´</span></span>\n<span class="line"><span style="color:#FFCB6B;">proxy_send_timeout</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">60</span><span style="color:#89DDFF;">;</span></span>\n<span class="line"></span>\n<span class="line"><span style="color:#676E95;font-style:italic;"># max_failsè®¾å®šNginxä¸upstreamæœåŠ¡å™¨é€šä¿¡çš„å°è¯•å¤±è´¥çš„æ¬¡æ•°ã€‚</span></span>\n<span class="line"><span style="color:#676E95;font-style:italic;"># åœ¨fail_timeoutå‚æ•°å®šä¹‰çš„æ—¶é—´æ®µå†…ï¼Œå¦‚æœå¤±è´¥çš„æ¬¡æ•°è¾¾åˆ°æ­¤å€¼ï¼ŒNginxå°±è®¤ä¸ºæœåŠ¡å™¨ä¸å¯ç”¨ã€‚</span></span>\n<span class="line"><span style="color:#FFCB6B;">upstream</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">big_server_com</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">{</span></span>\n<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#FFCB6B;">server</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">192.168.0.1:</span><span style="color:#F78C6C;">8000</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">weight=</span><span style="color:#F78C6C;">5</span><span style="color:#A6ACCD;">  </span><span style="color:#C3E88D;">max_fails=</span><span style="color:#F78C6C;">3</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">fail_timeout=30s</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;"># weightè¶Šé«˜ï¼Œæƒé‡è¶Šå¤§</span></span>\n<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#FFCB6B;">server</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">192.168.0.2:</span><span style="color:#F78C6C;">8000</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">weight=</span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">  </span><span style="color:#C3E88D;">max_fails=</span><span style="color:#F78C6C;">3</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">fail_timeout=30s</span><span style="color:#89DDFF;">;</span></span>\n<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#FFCB6B;">server</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">192.168.0.3:</span><span style="color:#F78C6C;">8000</span><span style="color:#89DDFF;">;</span></span>\n<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#FFCB6B;">server</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">192.168.0.4:</span><span style="color:#F78C6C;">8001</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">backup</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;"># çƒ­å¤‡</span></span>\n<span class="line"><span style="color:#A6ACCD;">}</span></span>\n<span class="line"></span></code></pre></div><h2 id="nginxè´Ÿè½½å‡è¡¡" tabindex="-1">Nginxè´Ÿè½½å‡è¡¡ <a class="header-anchor" href="#nginxè´Ÿè½½å‡è¡¡" aria-hidden="true">#</a></h2><p>Nginxæä¾›äº†å¤šç§è´Ÿè½½å‡è¡¡ç®—æ³•, æœ€å¸¸è§çš„æœ‰5ç§ã€‚æˆ‘ä»¬åªéœ€ä¿®æ”¹å¯¹åº”upstreamæ¨¡å—å³å¯ã€‚</p><h2 id="è½®è¯¢-é»˜è®¤" tabindex="-1">è½®è¯¢(é»˜è®¤) <a class="header-anchor" href="#è½®è¯¢-é»˜è®¤" aria-hidden="true">#</a></h2><p>æ¯ä¸ªè¯·æ±‚æŒ‰æ—¶é—´é¡ºåºé€ä¸€åˆ†é…åˆ°ä¸åŒçš„åç«¯æœåŠ¡å™¨ï¼Œå¦‚æœåç«¯æœåŠ¡å™¨downæ‰ï¼Œèƒ½è‡ªåŠ¨å‰”é™¤;</p><div class="language-nginx"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#676E95;font-style:italic;"># è½®è¯¢ï¼Œå¤§å®¶æƒé‡ä¸€æ ·</span></span>\n<span class="line"><span style="color:#C792EA;">upstream</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">backend_server </span><span style="color:#A6ACCD;">{</span></span>\n<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;">server</span><span style="color:#A6ACCD;"> 192.168.0.1:8000;</span></span>\n<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;">server</span><span style="color:#A6ACCD;"> 192.168.0.2:8000;</span></span>\n<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;">server</span><span style="color:#A6ACCD;"> 192.168.0.3:8000 down; </span><span style="color:#676E95;font-style:italic;"># ä¸å‚ä¸è´Ÿè½½å‡è¡¡</span></span>\n<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;">server</span><span style="color:#A6ACCD;"> 192.168.0.4:8001 backup; </span><span style="color:#676E95;font-style:italic;"># çƒ­å¤‡</span></span>\n<span class="line"><span style="color:#A6ACCD;">}</span></span>\n<span class="line"></span>\n<span class="line"><span style="color:#C792EA;">server</span><span style="color:#A6ACCD;"> {</span></span>\n<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;"> listen </span><span style="color:#A6ACCD;">         </span><span style="color:#F78C6C;">80</span><span style="color:#89DDFF;">;</span></span>\n<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;"> server_name </span><span style="color:#A6ACCD;">    big.server.com</span><span style="color:#89DDFF;">;</span></span>\n<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;"> access_log </span><span style="color:#A6ACCD;">     logs/big.server.access.log</span><span style="color:#89DDFF;"> main;</span></span>\n<span class="line"><span style="color:#A6ACCD;">    </span></span>\n<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;"> charset </span><span style="color:#A6ACCD;">utf-8</span><span style="color:#89DDFF;">;</span></span>\n<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;"> client_max_body_size </span><span style="color:#A6ACCD;">10M</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;"># é™åˆ¶ç”¨æˆ·ä¸Šä¼ æ–‡ä»¶å¤§å°ï¼Œé»˜è®¤1M</span></span>\n<span class="line"></span>\n<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#C792EA;">location</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">/ </span><span style="color:#A6ACCD;">{</span></span>\n<span class="line"><span style="color:#A6ACCD;">     </span><span style="color:#676E95;font-style:italic;"># ä½¿ç”¨proxy_passè½¬å‘è¯·æ±‚åˆ°é€šè¿‡upstreamå®šä¹‰çš„ä¸€ç»„åº”ç”¨æœåŠ¡å™¨</span></span>\n<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;"> proxy_pass </span><span style="color:#A6ACCD;">     http://backend_server</span><span style="color:#89DDFF;">;</span></span>\n<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;"> proxy_set_header </span><span style="color:#A6ACCD;">X-Forwarded-For </span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">proxy_add_x_forwarded_for</span><span style="color:#89DDFF;">;</span></span>\n<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;"> proxy_set_header </span><span style="color:#A6ACCD;">Host </span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">http_host</span><span style="color:#89DDFF;">;</span></span>\n<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;"> proxy_redirect </span><span style="color:#A6ACCD;">off</span><span style="color:#89DDFF;">;</span></span>\n<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;"> proxy_set_header </span><span style="color:#A6ACCD;">X-Real-IP  </span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">remote_addr</span><span style="color:#89DDFF;">;</span></span>\n<span class="line"><span style="color:#A6ACCD;">   }</span></span>\n<span class="line"></span></code></pre></div><h2 id="æƒé‡-weight" tabindex="-1">æƒé‡(weight) <a class="header-anchor" href="#æƒé‡-weight" aria-hidden="true">#</a></h2><p>é€šè¿‡weightæŒ‡å®šè½®è¯¢å‡ ç‡ï¼Œè®¿é—®æ¯”ç‡ä¸weightæˆæ­£æ¯”ï¼Œå¸¸ç”¨äºåç«¯æœåŠ¡å™¨æ€§èƒ½ä¸å‡çš„æƒ…å†µã€‚ä¸æ€ä¹ˆå¿™çš„æœåŠ¡å™¨å¯ä»¥å¤šæ‰¿æ‹…äº›ä»»åŠ¡ã€‚</p><div class="language-nginx"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#676E95;font-style:italic;"># æƒé‡ï¼Œweightè¶Šå¤§ï¼Œæ‰¿æ‹…ä»»åŠ¡è¶Šå¤š</span></span>\n<span class="line"><span style="color:#C792EA;">upstream</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">backend_server </span><span style="color:#A6ACCD;">{</span></span>\n<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;">server</span><span style="color:#A6ACCD;"> 192.168.0.1:8000 </span><span style="color:#A6ACCD;font-style:italic;">weight</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">3</span><span style="color:#A6ACCD;">;</span></span>\n<span class="line"><span style="color:#A6ACCD;">   server 192.168.0.2:8000 </span><span style="color:#A6ACCD;font-style:italic;">weight</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">;</span></span>\n<span class="line"><span style="color:#A6ACCD;">}</span></span>\n<span class="line"></span></code></pre></div><h2 id="ip-hash" tabindex="-1">ip_hash <a class="header-anchor" href="#ip-hash" aria-hidden="true">#</a></h2><p>æ¯ä¸ªè¯·æ±‚æŒ‰è®¿é—®ipçš„hashç»“æœåˆ†é…ï¼Œè¿™æ ·æ¯ä¸ªè®¿å®¢å›ºå®šè®¿é—®ä¸€ä¸ªåç«¯æœåŠ¡å™¨ï¼Œå¯ä»¥è§£å†³sessionçš„é—®é¢˜ã€‚</p><div class="language-nginx"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#676E95;font-style:italic;"># æƒé‡ï¼Œweightè¶Šå¤§ï¼Œæ‰¿æ‹…ä»»åŠ¡è¶Šå¤š</span></span>\n<span class="line"><span style="color:#C792EA;">upstream</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">backend_server </span><span style="color:#A6ACCD;">{</span></span>\n<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;">ip_hash;</span></span>\n<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;">server</span><span style="color:#A6ACCD;"> 192.168.0.1:8000;</span></span>\n<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;">server</span><span style="color:#A6ACCD;"> 192.168.0.2:8000;</span></span>\n<span class="line"><span style="color:#A6ACCD;">}</span></span>\n<span class="line"></span></code></pre></div><h2 id="url-hash" tabindex="-1">url_hash <a class="header-anchor" href="#url-hash" aria-hidden="true">#</a></h2><p>æŒ‰è®¿é—®urlçš„hashç»“æœæ¥åˆ†é…è¯·æ±‚ï¼Œä½¿æ¯ä¸ªurlå®šå‘åˆ°åŒä¸€ä¸ªåç«¯æœåŠ¡å™¨ï¼Œåç«¯æœåŠ¡å™¨ä¸ºç¼“å­˜æ—¶æ¯”è¾ƒæœ‰æ•ˆã€‚</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#676E95;font-style:italic;"># URL Hash</span></span>\n<span class="line"><span style="color:#FFCB6B;">upstream</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">backend_server</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">{</span></span>\n<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#82AAFF;">hash</span><span style="color:#A6ACCD;"> $request_uri</span><span style="color:#89DDFF;">;</span></span>\n<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#FFCB6B;">server</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">192.168.0.1:</span><span style="color:#F78C6C;">8000</span><span style="color:#89DDFF;">;</span></span>\n<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#FFCB6B;">server</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">192.168.0.2:</span><span style="color:#F78C6C;">8000</span><span style="color:#89DDFF;">;</span></span>\n<span class="line"><span style="color:#A6ACCD;">}</span></span>\n<span class="line"></span></code></pre></div><h2 id="fair-ç¬¬ä¸‰æ–¹" tabindex="-1">fair(ç¬¬ä¸‰æ–¹) <a class="header-anchor" href="#fair-ç¬¬ä¸‰æ–¹" aria-hidden="true">#</a></h2><p>æŒ‰åç«¯æœåŠ¡å™¨çš„å“åº”æ—¶é—´æ¥åˆ†é…è¯·æ±‚ï¼Œå“åº”æ—¶é—´çŸ­çš„ä¼˜å…ˆåˆ†é…ã€‚ä½¿ç”¨è¿™ä¸ªç®—æ³•éœ€è¦å®‰è£…<code>nginx-upstream-fair</code>è¿™ä¸ªåº“ã€‚</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#676E95;font-style:italic;"># Fair</span></span>\n<span class="line"><span style="color:#FFCB6B;">upstream</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">backend_server</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">{</span></span>\n<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#FFCB6B;">server</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">192.168.0.1:</span><span style="color:#F78C6C;">8000</span><span style="color:#89DDFF;">;</span></span>\n<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#FFCB6B;">server</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">192.168.0.2:</span><span style="color:#F78C6C;">8000</span><span style="color:#89DDFF;">;</span></span>\n<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#FFCB6B;">fair</span><span style="color:#89DDFF;">;</span></span>\n<span class="line"><span style="color:#A6ACCD;">}</span></span>\n<span class="line"></span></code></pre></div><h2 id="nginxä¸uwsgiæœåŠ¡å™¨çš„æ²Ÿé€š" tabindex="-1">Nginxä¸uWSGIæœåŠ¡å™¨çš„æ²Ÿé€š <a class="header-anchor" href="#nginxä¸uwsgiæœåŠ¡å™¨çš„æ²Ÿé€š" aria-hidden="true">#</a></h2><p>åœ¨å‰é¢çš„æ¡ˆä¾‹ä¸­ï¼ŒNginxéƒ½æ˜¯ä½¿ç”¨<code>proxy_pass</code>è½¬å‘çš„åŠ¨æ€è¯·æ±‚ï¼Œ<code>proxy_pass</code>ä½¿ç”¨æ™®é€šçš„HTTPåè®®ä¸åº”ç”¨æœåŠ¡å™¨è¿›è¡Œæ²Ÿé€šã€‚å¦‚æœä½ éƒ¨ç½²çš„æ˜¯Python Webåº”ç”¨(Django, Flask), ä½ çš„åº”ç”¨æœåŠ¡å™¨(<code>uwsgi</code>, <code>gunicorn</code>)ä¸€èˆ¬æ˜¯éµå®ˆuwsgiåè®®çš„ï¼Œå¯¹äºè¿™ç§æƒ…å†µï¼Œå»ºè®®ä½¿ç”¨<code>uwsgi_pass</code>è½¬å‘è¯·æ±‚ã€‚</p><h3 id="python-webåº”ç”¨éƒ¨ç½²è´Ÿè½½å‡è¡¡nginxé…ç½®æ–‡ä»¶å‚è€ƒ" tabindex="-1">Python Webåº”ç”¨éƒ¨ç½²è´Ÿè½½å‡è¡¡Nginxé…ç½®æ–‡ä»¶å‚è€ƒ <a class="header-anchor" href="#python-webåº”ç”¨éƒ¨ç½²è´Ÿè½½å‡è¡¡nginxé…ç½®æ–‡ä»¶å‚è€ƒ" aria-hidden="true">#</a></h3><p>å¦‚æœä½ éƒ¨ç½²çš„æ˜¯Djangoæˆ–åˆ™Flask Webåº”ç”¨ï¼Œä¸€ä¸ªå®Œæ•´çš„nginxé…ç½®æ–‡ä»¶å¦‚ä¸‹æ‰€ç¤ºï¼š</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#676E95;font-style:italic;"># nginxé…ç½®æ–‡ä»¶ï¼Œnginx.conf</span></span>\n<span class="line"></span>\n<span class="line"><span style="color:#676E95;font-style:italic;"># å…¨å±€å—</span></span>\n<span class="line"><span style="color:#FFCB6B;">user</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">www-data</span><span style="color:#89DDFF;">;</span></span>\n<span class="line"><span style="color:#FFCB6B;">worker_processes</span><span style="color:#A6ACCD;">  </span><span style="color:#F78C6C;">2</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;">  </span><span style="color:#676E95;font-style:italic;">## é»˜è®¤1ï¼Œä¸€èˆ¬å»ºè®®è®¾æˆCPUæ ¸æ•°1-2å€</span></span>\n<span class="line"></span>\n<span class="line"><span style="color:#676E95;font-style:italic;"># Eventså—</span></span>\n<span class="line"><span style="color:#FFCB6B;">events</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">{</span></span>\n<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#676E95;font-style:italic;"># ä½¿ç”¨epollçš„I/O æ¨¡å‹å¤„ç†è½®è¯¢äº‹ä»¶ã€‚</span></span>\n<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#676E95;font-style:italic;"># å¯ä»¥ä¸è®¾ç½®ï¼Œnginxä¼šæ ¹æ®æ“ä½œç³»ç»Ÿé€‰æ‹©åˆé€‚çš„æ¨¡å‹</span></span>\n<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#FFCB6B;">use</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">epoll</span><span style="color:#89DDFF;">;</span></span>\n<span class="line"><span style="color:#A6ACCD;">  </span></span>\n<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#676E95;font-style:italic;"># å·¥ä½œè¿›ç¨‹çš„æœ€å¤§è¿æ¥æ•°é‡, é»˜è®¤1024ä¸ª</span></span>\n<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#FFCB6B;">worker_connections</span><span style="color:#A6ACCD;">  </span><span style="color:#F78C6C;">2048</span><span style="color:#89DDFF;">;</span></span>\n<span class="line"><span style="color:#A6ACCD;">  </span></span>\n<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#676E95;font-style:italic;"># httpå±‚é¢çš„keep-aliveè¶…æ—¶æ—¶é—´</span></span>\n<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#FFCB6B;">keepalive_timeout</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">60</span><span style="color:#89DDFF;">;</span></span>\n<span class="line"><span style="color:#A6ACCD;">  </span></span>\n<span class="line"><span style="color:#A6ACCD;">}</span></span>\n<span class="line"></span>\n<span class="line"><span style="color:#FFCB6B;">http</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">{</span><span style="color:#A6ACCD;">    </span></span>\n<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;font-style:italic;"># å¼€å¯gzipå‹ç¼©åŠŸèƒ½</span></span>\n<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#FFCB6B;">gzip</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">on</span><span style="color:#89DDFF;">;</span></span>\n<span class="line"><span style="color:#A6ACCD;">    </span></span>\n<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;font-style:italic;"># è®¾ç½®å…è®¸å‹ç¼©çš„é¡µé¢æœ€å°å­—èŠ‚æ•°; è¿™é‡Œè¡¨ç¤ºå¦‚æœæ–‡ä»¶å°äº10kï¼Œå‹ç¼©æ²¡æœ‰æ„ä¹‰.</span></span>\n<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#FFCB6B;">gzip_min_length</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">10k</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span></span>\n<span class="line"><span style="color:#A6ACCD;">    </span></span>\n<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;font-style:italic;"># è®¾ç½®å‹ç¼©æ¯”ç‡ï¼Œæœ€å°ä¸º1ï¼Œå¤„ç†é€Ÿåº¦å¿«ï¼Œä¼ è¾“é€Ÿåº¦æ…¢ï¼›</span></span>\n<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;font-style:italic;"># 9ä¸ºæœ€å¤§å‹ç¼©æ¯”ï¼Œå¤„ç†é€Ÿåº¦æ…¢ï¼Œä¼ è¾“é€Ÿåº¦å¿«; æ¨è6</span></span>\n<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#FFCB6B;">gzip_comp_level</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">6</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span></span>\n<span class="line"><span style="color:#A6ACCD;">    </span></span>\n<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;font-style:italic;"># è®¾ç½®å‹ç¼©ç¼“å†²åŒºå¤§å°ï¼Œæ­¤å¤„è®¾ç½®ä¸º16ä¸ª8Kå†…å­˜ä½œä¸ºå‹ç¼©ç»“æœç¼“å†²</span></span>\n<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#FFCB6B;">gzip_buffers</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">16</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">8k</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span></span>\n<span class="line"><span style="color:#A6ACCD;">    </span></span>\n<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;font-style:italic;"># è®¾ç½®å“ªäº›æ–‡ä»¶éœ€è¦å‹ç¼©,ä¸€èˆ¬æ–‡æœ¬ï¼Œcsså’Œjså»ºè®®å‹ç¼©ã€‚å›¾ç‰‡è§†éœ€è¦è¦é”ã€‚</span></span>\n<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#FFCB6B;">gzip_types</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">text/plain</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">text/css</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">application/json</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">application/x-javascript</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">text/xml</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">application/xml</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">application/xml+rss</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">text/javascript</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span></span>\n<span class="line"><span style="color:#A6ACCD;">    </span></span>\n<span class="line"><span style="color:#A6ACCD;">    </span></span>\n<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#FFCB6B;">upstream</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">backend_server</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">{</span></span>\n<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#FFCB6B;">server</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">192.168.0.1:</span><span style="color:#F78C6C;">8000</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;"># æ›¿æ¢æˆåº”ç”¨æœåŠ¡å™¨æˆ–å®¹å™¨å®é™…IPåŠç«¯å£</span></span>\n<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#FFCB6B;">server</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">192.168.0.2:</span><span style="color:#F78C6C;">8000</span><span style="color:#89DDFF;">;</span></span>\n<span class="line"><span style="color:#A6ACCD;">    }</span></span>\n<span class="line"></span>\n<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#FFCB6B;">server</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">{</span></span>\n<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#FFCB6B;">listen</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">80</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;"># ç›‘å¬80ç«¯å£</span></span>\n<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#FFCB6B;">server_name</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">localhost</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;"># å¯ä»¥æ˜¯nginxå®¹å™¨æ‰€åœ¨ipåœ°å€æˆ–127.0.0.1ï¼Œä¸èƒ½å†™å®¿ä¸»æœºå¤–ç½‘ipåœ°å€</span></span>\n<span class="line"></span>\n<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#FFCB6B;">charset</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">utf-</span><span style="color:#F78C6C;">8</span><span style="color:#89DDFF;">;</span></span>\n<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#FFCB6B;">client_max_body_size</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">10M</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;"># é™åˆ¶ç”¨æˆ·ä¸Šä¼ æ–‡ä»¶å¤§å°</span></span>\n<span class="line"><span style="color:#A6ACCD;">        </span></span>\n<span class="line"><span style="color:#A6ACCD;">         </span><span style="color:#676E95;font-style:italic;"># å®¢æˆ·ç«¯è¯·æ±‚å¤´éƒ¨çš„ç¼“å†²åŒºå¤§å°</span></span>\n<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#FFCB6B;">client_header_buffer_size</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">2k</span><span style="color:#89DDFF;">;</span></span>\n<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#FFCB6B;">client_header_timeout</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">15</span><span style="color:#89DDFF;">;</span></span>\n<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#FFCB6B;">client_body_timeout</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">15</span><span style="color:#89DDFF;">;</span></span>\n<span class="line"><span style="color:#A6ACCD;">    </span></span>\n<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#FFCB6B;">access_log</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/var/log/nginx/mysite1.access.log</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">main</span><span style="color:#89DDFF;">;</span></span>\n<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#FFCB6B;">error_log</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/var/log/nginx/mysite1.error.log</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">warn</span><span style="color:#89DDFF;">;</span></span>\n<span class="line"><span style="color:#A6ACCD;">        </span></span>\n<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#676E95;font-style:italic;"># é™æ€èµ„æºè·¯å¾„</span></span>\n<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#FFCB6B;">location</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/static</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">{</span></span>\n<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#82AAFF;">alias</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/usr/share/nginx/html/static</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span></span>\n<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#FFCB6B;">}</span></span>\n<span class="line"><span style="color:#A6ACCD;">        </span></span>\n<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#676E95;font-style:italic;"># åª’ä½“èµ„æºè·¯å¾„ï¼Œç”¨æˆ·ä¸Šä¼ æ–‡ä»¶è·¯å¾„</span></span>\n<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#FFCB6B;">location</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/media</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">{</span></span>\n<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#82AAFF;">alias</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/usr/share/nginx/html/media</span><span style="color:#89DDFF;">;</span></span>\n<span class="line"><span style="color:#A6ACCD;">        }</span></span>\n<span class="line"></span>\n<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#FFCB6B;">location</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">{</span><span style="color:#A6ACCD;">     </span></span>\n<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#FFCB6B;">include</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/etc/nginx/uwsgi_params</span><span style="color:#89DDFF;">;</span></span>\n<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#FFCB6B;">uwsgi_pass</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">backend_server</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;">   </span><span style="color:#676E95;font-style:italic;"># ä½¿ç”¨uwsgi_pass, è€Œä¸æ˜¯proxy_pass</span></span>\n<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#FFCB6B;">uwsgi_read_timeout</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">600</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;"># æŒ‡å®šæ¥æ”¶uWSGIåº”ç­”çš„è¶…æ—¶æ—¶é—´</span></span>\n<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#FFCB6B;">uwsgi_connect_timeout</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">600</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;">  </span><span style="color:#676E95;font-style:italic;"># æŒ‡å®šè¿æ¥åˆ°åç«¯uWSGIçš„è¶…æ—¶æ—¶é—´ã€‚</span></span>\n<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#FFCB6B;">uwsgi_send_timeout</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">600</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;"># æŒ‡å®šå‘uWSGIä¼ é€è¯·æ±‚çš„è¶…æ—¶æ—¶é—´</span></span>\n<span class="line"></span>\n<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#FFCB6B;">proxy_set_header</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">X-Forwarded-For</span><span style="color:#A6ACCD;"> $proxy_add_x_forwarded_for</span><span style="color:#89DDFF;">;</span></span>\n<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#FFCB6B;">proxy_set_header</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">Host</span><span style="color:#A6ACCD;"> $http_host</span><span style="color:#89DDFF;">;</span></span>\n<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#FFCB6B;">proxy_redirect</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">off</span><span style="color:#89DDFF;">;</span></span>\n<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#FFCB6B;">proxy_set_header</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">X-Real-IP</span><span style="color:#A6ACCD;">  $remote_addr</span><span style="color:#89DDFF;">;</span></span>\n<span class="line"><span style="color:#A6ACCD;">        }</span></span>\n<span class="line"><span style="color:#A6ACCD;">    }</span></span>\n<span class="line"><span style="color:#A6ACCD;">    </span></span>\n<span class="line"><span style="color:#A6ACCD;">} </span></span>\n<span class="line"></span>\n<span class="line"></span>\n<span class="line"></span></code></pre></div><p>å¦‚æœä½ çš„nginxä¸uwsgiåœ¨åŒä¸€å°æœåŠ¡å™¨ä¸Šï¼Œç”¨ä¸åˆ°è´Ÿè½½å‡è¡¡ï¼Œä½ è¿˜å¯ä»¥é€šè¿‡æœ¬åœ°æœºå™¨çš„unix socketè¿›è¡Œé€šä¿¡ï¼Œè¿™æ ·é€Ÿåº¦æ›´å¿«ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">location</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">{</span><span style="color:#A6ACCD;">     </span></span>\n<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#FFCB6B;">include</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/etc/nginx/uwsgi_params</span><span style="color:#89DDFF;">;</span></span>\n<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#FFCB6B;">uwsgi_pass</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">unix:/run/uwsgi/django_test1.sock</span><span style="color:#89DDFF;">;</span></span>\n<span class="line"><span style="color:#A6ACCD;">}</span></span>\n<span class="line"></span></code></pre></div><p><strong>æ³¨æ„</strong>ï¼šå–å†³äºNginxé‡‡ç”¨é‚£ç§æ–¹å¼ä¸uWSGIæœåŠ¡å™¨è¿›è¡Œé€šä¿¡(æœ¬åœ°socket, ç½‘ç»œTCP socketå’Œhttpåè®®)ï¼ŒuWSGIçš„é…ç½®æ–‡ä»¶ä¹Ÿä¼šæœ‰æ‰€ä¸åŒã€‚è¿™é‡Œä»¥<code>uwsgi.ini</code>ä¸ºä¾‹å±•ç¤ºäº†ä¸åŒã€‚</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#676E95;font-style:italic;"># uwsgi.inié…ç½®æ–‡ä»¶</span></span>\n<span class="line"></span>\n<span class="line"><span style="color:#676E95;font-style:italic;"># å¯¹äºuwsgi_passè½¬å‘çš„è¯·æ±‚ï¼Œä½¿ç”¨æœ¬åœ°unix socketé€šä¿¡</span></span>\n<span class="line"><span style="color:#676E95;font-style:italic;"># ä»…é€‚ç”¨äºnginxå’Œuwsgiåœ¨åŒä¸€å°æœåŠ¡å™¨ä¸Šçš„æƒ…å½¢</span></span>\n<span class="line"><span style="color:#A6ACCD;">socket</span><span style="color:#89DDFF;">=</span><span style="color:#C3E88D;">/run/uwsgi/django_test1.sock</span></span>\n<span class="line"></span>\n<span class="line"><span style="color:#676E95;font-style:italic;"># å¯¹äºuwsgi_passè½¬å‘çš„è¯·æ±‚ï¼Œä½¿ç”¨TCP socketé€šä¿¡</span></span>\n<span class="line"><span style="color:#A6ACCD;">socket</span><span style="color:#89DDFF;">=</span><span style="color:#C3E88D;">0.0.0.0:</span><span style="color:#F78C6C;">8000</span></span>\n<span class="line"></span>\n<span class="line"><span style="color:#676E95;font-style:italic;"># å¯¹äºproxy_pass HTTPè½¬å‘çš„è¯·æ±‚ï¼Œä½¿ç”¨httpåè®®</span></span>\n<span class="line"><span style="color:#A6ACCD;">http</span><span style="color:#89DDFF;">=</span><span style="color:#C3E88D;">0.0.0.0:</span><span style="color:#F78C6C;">8000</span></span>\n<span class="line"></span></code></pre></div><h2 id="ç¤ºä¾‹" tabindex="-1">ç¤ºä¾‹ <a class="header-anchor" href="#ç¤ºä¾‹" aria-hidden="true">#</a></h2><p><strong>ç¯å¢ƒ:CentOS Linux release 7.5.1804 (Core)</strong><strong>é˜¿é‡Œäº‘ æœåŠ¡å™¨</strong></p><table><thead><tr><th>ä»£ç </th><th>æ³¨é‡Š</th></tr></thead><tbody><tr><td>sudo yum install nginx</td><td>å®‰è£…nginx</td></tr><tr><td>sudo systemctl enable nginx</td><td>è®¾ç½®å¼€æœºå¯åŠ¨</td></tr><tr><td>sudo systemctl start nginx</td><td>å¯åŠ¨æœåŠ¡</td></tr><tr><td>sudo systemctl stop nginx</td><td>åœæ­¢æœåŠ¡</td></tr><tr><td>sudo systemctl restart nginx</td><td>é‡å¯æœåŠ¡</td></tr><tr><td>sudo systemctl reload nginx</td><td>é‡æ–°åŠ è½½ï¼Œå› ä¸ºä¸€èˆ¬é‡æ–°é…ç½®ä¹‹åï¼Œä¸å¸Œæœ›é‡å¯æœåŠ¡ï¼Œè¿™æ—¶å¯ä»¥ä½¿ç”¨é‡æ–°åŠ è½½ã€‚</td></tr><tr><td>sudo nginx -t</td><td>éªŒè¯é…ç½®æ–‡ä»¶æ˜¯å¦æœ‰è¯­æ³•é”™è¯¯</td></tr><tr><td>sudo systemctl status nginx</td><td>æŸ¥çœ‹ nginx çŠ¶æ€</td></tr></tbody></table><h2 id="é»˜è®¤-nginx-ç›®å½•è·¯å¾„ã€‚" tabindex="-1">é»˜è®¤ nginx ç›®å½•è·¯å¾„ã€‚ <a class="header-anchor" href="#é»˜è®¤-nginx-ç›®å½•è·¯å¾„ã€‚" aria-hidden="true">#</a></h2><ul><li><p>/var/log/nginx/ ï¼šæ—¥å¿—æ–‡ä»¶ç›®å½•ï¼Œé€šå¸¸åŒ…å«<code>access.log</code>å’Œ<code>error.log</code>ä¸¤ä¸ªä¸»æ—¥å¿—æ–‡ä»¶ï¼Œä»¥åŠå„ä¸ªç«™ç‚¹çš„æ—¥å¿—ã€‚</p></li><li><p>/etc/nginx/ï¼šé…ç½®æ–‡ä»¶ç›®å½•ã€‚</p></li><li><p>/etc/nginx/sites-available/ï¼šæ‰€æœ‰ç«™ç‚¹çš„é…ç½®æ–‡ä»¶ç›®å½•ã€‚</p></li><li><p>/etc/nginx/sites-enabled/ï¼šç”Ÿæ•ˆç«™ç‚¹çš„é…ç½®æ–‡ä»¶ç›®å½•ï¼Œé€šå¸¸æ˜¯<code>/etc/nginx/sites-available/</code>å¯¹åº”æ–‡ä»¶çš„è½¯è¿æ¥ã€‚</p></li><li><p>/etc/nginx/nginx.confï¼šä¸»é…ç½®æ–‡ä»¶ã€‚</p></li></ul><h2 id="æˆ‘çš„nginxé…ç½®" tabindex="-1">æˆ‘çš„nginxé…ç½® <a class="header-anchor" href="#æˆ‘çš„nginxé…ç½®" aria-hidden="true">#</a></h2><p><strong>ä¸€ä¸ªåŸŸåä½œä¸ºé»˜è®¤ç½‘å€</strong></p><p><strong>è§£æçš„ä¸€ä¸ªåŸŸåä½œä¸ºapiæ¥å£</strong></p><p><strong>åˆ†åˆ«é…ç½®äº†æ¥å£è½¬å‘å’Œhttpsä»£ç†</strong></p><div class="language-nginx"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#676E95;font-style:italic;"># For more information on configuration, see:</span></span>\n<span class="line"><span style="color:#676E95;font-style:italic;">#   * Official English Documentation: http://nginx.org/en/docs/</span></span>\n<span class="line"><span style="color:#676E95;font-style:italic;">#   * Official Russian Documentation: http://nginx.org/ru/docs/</span></span>\n<span class="line"></span>\n<span class="line"><span style="color:#89DDFF;">user </span><span style="color:#A6ACCD;">nginx</span><span style="color:#89DDFF;">;</span></span>\n<span class="line"><span style="color:#89DDFF;">worker_processes </span><span style="color:#A6ACCD;">auto</span><span style="color:#89DDFF;">;</span></span>\n<span class="line"><span style="color:#89DDFF;">error_log </span><span style="color:#A6ACCD;">/var/log/nginx/error.log</span><span style="color:#89DDFF;">;</span></span>\n<span class="line"><span style="color:#89DDFF;">pid </span><span style="color:#A6ACCD;">/run/nginx.pid</span><span style="color:#89DDFF;">;</span></span>\n<span class="line"></span>\n<span class="line"></span>\n<span class="line"></span>\n<span class="line"><span style="color:#C792EA;">events</span><span style="color:#A6ACCD;"> {</span></span>\n<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> worker_connections </span><span style="color:#A6ACCD;">1024</span><span style="color:#89DDFF;">;</span></span>\n<span class="line"><span style="color:#A6ACCD;">}</span></span>\n<span class="line"></span>\n<span class="line"></span>\n<span class="line"><span style="color:#C792EA;">http</span><span style="color:#A6ACCD;"> {</span></span>\n<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> log_format  main</span><span style="color:#A6ACCD;">  </span><span style="color:#C3E88D;">&#39;</span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">remote_addr</span><span style="color:#C3E88D;"> - </span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">remote_user</span><span style="color:#C3E88D;"> [</span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">time_local</span><span style="color:#C3E88D;">] &quot;</span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">request</span><span style="color:#C3E88D;">&quot; &#39;</span></span>\n<span class="line"><span style="color:#A6ACCD;">                      </span><span style="color:#C3E88D;">&#39;</span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">status</span><span style="color:#C3E88D;"> </span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">body_bytes_sent</span><span style="color:#C3E88D;"> &quot;</span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">http_referer</span><span style="color:#C3E88D;">&quot; &#39;</span></span>\n<span class="line"><span style="color:#A6ACCD;">                      </span><span style="color:#C3E88D;">&#39;&quot;</span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">http_user_agent</span><span style="color:#C3E88D;">&quot; &quot;</span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">http_x_forwarded_for</span><span style="color:#C3E88D;">&quot;&#39;</span><span style="color:#89DDFF;">;</span></span>\n<span class="line"></span>\n<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> access_log </span><span style="color:#A6ACCD;"> /var/log/nginx/access.log </span><span style="color:#89DDFF;"> main;</span></span>\n<span class="line"></span>\n<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> sendfile </span><span style="color:#A6ACCD;">          </span><span style="color:#89DDFF;"> on;</span></span>\n<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> tcp_nopush </span><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;"> on;</span></span>\n<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> tcp_nodelay </span><span style="color:#A6ACCD;">       </span><span style="color:#89DDFF;"> on;</span></span>\n<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> keepalive_timeout </span><span style="color:#A6ACCD;">  </span><span style="color:#F78C6C;">65</span><span style="color:#89DDFF;">;</span></span>\n<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> types_hash_max_size </span><span style="color:#A6ACCD;">2048</span><span style="color:#89DDFF;">;</span></span>\n<span class="line"></span>\n<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> include </span><span style="color:#A6ACCD;">            /etc/nginx/mime.types</span><span style="color:#89DDFF;">;</span></span>\n<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> default_type </span><span style="color:#A6ACCD;">       application/octet-stream</span><span style="color:#89DDFF;">;</span></span>\n<span class="line"></span>\n<span class="line"><span style="color:#A6ACCD;">     </span><span style="color:#C792EA;">server</span><span style="color:#A6ACCD;"> {</span></span>\n<span class="line"><span style="color:#A6ACCD;">       </span><span style="color:#89DDFF;"> listen </span><span style="color:#A6ACCD;">      </span><span style="color:#F78C6C;">80</span><span style="color:#89DDFF;">;</span></span>\n<span class="line"><span style="color:#A6ACCD;">       </span><span style="color:#89DDFF;"> server_name </span><span style="color:#A6ACCD;"> www.xxx.com</span><span style="color:#89DDFF;">;</span></span>\n<span class="line"></span>\n<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#C792EA;">location</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">/ </span><span style="color:#A6ACCD;">{</span></span>\n<span class="line"><span style="color:#A6ACCD;">           </span><span style="color:#89DDFF;"> proxy_set_header </span><span style="color:#A6ACCD;">X-Forwarded-For </span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">proxy_add_x_forwarded_for</span><span style="color:#89DDFF;">;</span></span>\n<span class="line"><span style="color:#A6ACCD;">           </span><span style="color:#89DDFF;"> proxy_set_header </span><span style="color:#A6ACCD;">Host </span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">http_host</span><span style="color:#89DDFF;">;</span></span>\n<span class="line"><span style="color:#A6ACCD;">           </span><span style="color:#89DDFF;"> proxy_set_header </span><span style="color:#A6ACCD;">X-NginX-Proxy</span><span style="color:#89DDFF;"> true;</span></span>\n<span class="line"><span style="color:#A6ACCD;">           </span><span style="color:#89DDFF;"> proxy_http_version </span><span style="color:#A6ACCD;">1.1</span><span style="color:#89DDFF;">;</span></span>\n<span class="line"><span style="color:#A6ACCD;">           </span><span style="color:#89DDFF;"> proxy_set_header </span><span style="color:#A6ACCD;">Upgrade </span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">http_upgrade</span><span style="color:#89DDFF;">;</span></span>\n<span class="line"><span style="color:#A6ACCD;">           </span><span style="color:#89DDFF;"> proxy_set_header </span><span style="color:#A6ACCD;">Connection </span><span style="color:#C3E88D;">&quot;upgrade&quot;</span><span style="color:#89DDFF;">;</span></span>\n<span class="line"><span style="color:#A6ACCD;">           </span><span style="color:#89DDFF;"> proxy_max_temp_file_size </span><span style="color:#A6ACCD;">0</span><span style="color:#89DDFF;">;</span></span>\n<span class="line"><span style="color:#A6ACCD;">           </span><span style="color:#89DDFF;"> proxy_pass </span><span style="color:#A6ACCD;">http://127.0.0.1:3000/</span><span style="color:#89DDFF;">;</span></span>\n<span class="line"><span style="color:#A6ACCD;">           </span><span style="color:#89DDFF;"> proxy_redirect </span><span style="color:#A6ACCD;">off</span><span style="color:#89DDFF;">;</span></span>\n<span class="line"><span style="color:#A6ACCD;">           </span><span style="color:#89DDFF;"> proxy_read_timeout </span><span style="color:#A6ACCD;">240s</span><span style="color:#89DDFF;">;</span></span>\n<span class="line"><span style="color:#A6ACCD;">        }</span></span>\n<span class="line"><span style="color:#A6ACCD;">       </span></span>\n<span class="line"><span style="color:#A6ACCD;">       </span><span style="color:#89DDFF;"> error_page </span><span style="color:#A6ACCD;">404 /404.html</span><span style="color:#89DDFF;">;</span></span>\n<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#C792EA;">location</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/40x.html </span><span style="color:#A6ACCD;">{</span></span>\n<span class="line"><span style="color:#A6ACCD;">        }</span></span>\n<span class="line"></span>\n<span class="line"><span style="color:#A6ACCD;">       </span><span style="color:#89DDFF;"> error_page </span><span style="color:#A6ACCD;">500 </span><span style="color:#F78C6C;">502</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">503</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">504</span><span style="color:#A6ACCD;"> /50x.html</span><span style="color:#89DDFF;">;</span></span>\n<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#C792EA;">location</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/50x.html </span><span style="color:#A6ACCD;">{</span></span>\n<span class="line"><span style="color:#A6ACCD;">        }</span></span>\n<span class="line"><span style="color:#A6ACCD;">    }</span></span>\n<span class="line"></span>\n<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">server</span><span style="color:#A6ACCD;"> {</span></span>\n<span class="line"><span style="color:#A6ACCD;">       </span><span style="color:#89DDFF;"> listen </span><span style="color:#A6ACCD;">443</span><span style="color:#89DDFF;">;</span></span>\n<span class="line"><span style="color:#A6ACCD;">       </span><span style="color:#89DDFF;"> server_name </span><span style="color:#A6ACCD;">www.xxx.com</span><span style="color:#89DDFF;">;</span></span>\n<span class="line"><span style="color:#A6ACCD;">       </span><span style="color:#89DDFF;"> ssl </span><span style="color:#A6ACCD;">on</span><span style="color:#89DDFF;">;</span></span>\n<span class="line"><span style="color:#A6ACCD;">       </span><span style="color:#89DDFF;"> ssl_certificate </span><span style="color:#A6ACCD;"> /root/web/Blog/cert/xxx.pem</span><span style="color:#89DDFF;">;</span></span>\n<span class="line"><span style="color:#A6ACCD;">       </span><span style="color:#89DDFF;"> ssl_certificate_key </span><span style="color:#A6ACCD;">/root/web/Blog/cert/xxx.key</span><span style="color:#89DDFF;">;</span></span>\n<span class="line"><span style="color:#A6ACCD;">       </span><span style="color:#89DDFF;"> ssl_session_timeout </span><span style="color:#A6ACCD;">5m</span><span style="color:#89DDFF;">;</span></span>\n<span class="line"><span style="color:#A6ACCD;">       </span><span style="color:#89DDFF;"> ssl_ciphers </span><span style="color:#A6ACCD;">ECDHE-RSA-AES128-GCM-SHA256:ECDHE:ECDH:AES:HIGH:!NULL:!aNULL:!MD5:!ADH:!RC4</span><span style="color:#89DDFF;">;</span></span>\n<span class="line"><span style="color:#A6ACCD;">       </span><span style="color:#89DDFF;"> ssl_protocols </span><span style="color:#A6ACCD;">TLSv1 TLSv1.1 TLSv1.2</span><span style="color:#89DDFF;">;</span></span>\n<span class="line"><span style="color:#A6ACCD;">       </span><span style="color:#89DDFF;"> ssl_prefer_server_ciphers </span><span style="color:#A6ACCD;">on</span><span style="color:#89DDFF;">;</span></span>\n<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#C792EA;">location</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">/ </span><span style="color:#A6ACCD;">{</span></span>\n<span class="line"><span style="color:#A6ACCD;">          </span><span style="color:#89DDFF;"> proxy_set_header </span><span style="color:#A6ACCD;">X-Forwarded-For </span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">proxy_add_x_forwarded_for</span><span style="color:#89DDFF;">;</span></span>\n<span class="line"><span style="color:#A6ACCD;">           </span><span style="color:#89DDFF;"> proxy_set_header </span><span style="color:#A6ACCD;">Host </span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">http_host</span><span style="color:#89DDFF;">;</span></span>\n<span class="line"><span style="color:#A6ACCD;">           </span><span style="color:#89DDFF;"> proxy_set_header </span><span style="color:#A6ACCD;">X-NginX-Proxy</span><span style="color:#89DDFF;"> true;</span></span>\n<span class="line"><span style="color:#A6ACCD;">           </span><span style="color:#89DDFF;"> proxy_http_version </span><span style="color:#A6ACCD;">1.1</span><span style="color:#89DDFF;">;</span></span>\n<span class="line"><span style="color:#A6ACCD;">           </span><span style="color:#89DDFF;"> proxy_set_header </span><span style="color:#A6ACCD;">Upgrade </span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">http_upgrade</span><span style="color:#89DDFF;">;</span></span>\n<span class="line"><span style="color:#A6ACCD;">           </span><span style="color:#89DDFF;"> proxy_set_header </span><span style="color:#A6ACCD;">Connection </span><span style="color:#C3E88D;">&quot;upgrade&quot;</span><span style="color:#89DDFF;">;</span></span>\n<span class="line"><span style="color:#A6ACCD;">           </span><span style="color:#89DDFF;"> proxy_max_temp_file_size </span><span style="color:#A6ACCD;">0</span><span style="color:#89DDFF;">;</span></span>\n<span class="line"><span style="color:#A6ACCD;">           </span><span style="color:#89DDFF;"> proxy_pass </span><span style="color:#A6ACCD;">http://127.0.0.1:3000/</span><span style="color:#89DDFF;">;</span></span>\n<span class="line"><span style="color:#A6ACCD;">           </span><span style="color:#89DDFF;"> proxy_redirect </span><span style="color:#A6ACCD;">off</span><span style="color:#89DDFF;">;</span></span>\n<span class="line"><span style="color:#A6ACCD;">           </span><span style="color:#89DDFF;"> proxy_read_timeout </span><span style="color:#A6ACCD;">240s</span><span style="color:#89DDFF;">;</span></span>\n<span class="line"><span style="color:#A6ACCD;">        }</span></span>\n<span class="line"><span style="color:#A6ACCD;">      }</span></span>\n<span class="line"><span style="color:#A6ACCD;">     </span></span>\n<span class="line"><span style="color:#A6ACCD;">}</span></span>\n<span class="line"></span>\n<span class="line"></span></code></pre></div>',100)];const t=s(o,[["render",function(s,l,p,o,t,c){return n(),a("div",null,e)}]]);export{p as __pageData,t as default};
